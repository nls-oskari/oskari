(function(){function c(){return l}var e=this,t=!1,n=window.console!=null&&window.console.debug,s=function(e){if(!t)return;if(!n)return;window.console.debug(e)},o=function(){this.lang=null,this.localizations={}};o.prototype={setLocalization:function(e,t,n){this.localizations[e]||(this.localizations[e]={}),this.localizations[e][t]=n},setLang:function(e){this.lang=e},getLang:function(){return this.lang},getLocalization:function(e){return this.localizations[this.lang][e]}};var u=new o,a=!1,f="default",l=!0,h=function(){this.packages={},this.protocols={},this.inheritance={},this.aspects={},this.clazzcache={},this.globals={}};h.prototype={purge:function(){},protocol:function(){var e=arguments;if(e.length==0)throw"missing arguments";return this.protocols[e[0]]},pdefsp:function(e){var t=this.clazzcache[e],n=null,r=null,i=null;if(!t){var s=e.split("."),n=s[0],r=s[1],i=s.slice(2).join("."),o=this.packages[r];o||(o={},this.packages[r]=o),t=o[i],this.clazzcache[e]=t}return t},metadata:function(){var e=arguments;if(e.length==0)throw"missing arguments";var t=e[0],n=this.pdefsp(t);if(!n)throw"clazz "+t+" does not exist";return n._metadata},updateMetadata:function(e,t,n,r,i){r._metadata||(r._metadata={}),r._metadata.meta=i;var s=i.protocol;if(s)for(var o=0;o<s.length;o++){var u=s[o];this.protocols[u]||(this.protocols[u]={});var a=e+"."+t+"."+n;this.protocols[u][a]=r}},_super:function(){var e=arguments[0],t=arguments[1],n=this;return function(){return n._._superCategory[e][t].apply(n,arguments)}},define:function(){var e=arguments;if(e.length==0)throw"missing arguments";var t=e[0],n=t.split("."),r=n[0],i=n[1],s=n.slice(2).join("."),o=this.packages[i];o||(o={},this.packages[i]=o);var u=o[s];if(u){e[1]&&(u._constructor=e[1]);var a=e[2],f=u._class.prototype;for(p in a){var l=a[p];f[p]=l}var c=t;a&&(u._category[c]=a);if(e.length>3){var h=e[3].extend;for(var d=0;h&&d<h.length;d++){var v=this.lookup(h[d]);v._composition.subClazz||(v._composition.subClazz={}),v._composition.subClazz[h[d]]=u,u._composition.superClazz=v}this.updateMetadata(r,i,s,u,e[3])}return this.pullDown(u),this.pushDown(u),u}var m=function(){},g={clazzName:t,superClazz:null,subClazz:null};m.prototype={},u={_class:m,_constructor:e[1],_category:{},_composition:g},m.prototype._=u,m.prototype._super=this._super;var a=e[2],f=m.prototype;for(p in a){var l=a[p];f[p]=l}var c=t;a&&(u._category[c]=a),this.inheritance[t]=g,o[s]=u;if(e.length>3){var h=e[3].extend;for(var d=0;h&&d<h.length;d++){var v=this.lookup(h[d]);v._composition.subClazz||(v._composition.subClazz={}),v._composition.subClazz[t]=u,u._composition.superClazz=v}this.updateMetadata(r,i,s,u,e[3])}return this.pullDown(u),this.pushDown(u),u},category:function(){var e=arguments;if(e.length==0)throw"missing arguments";var t=e[0],n=t.split("."),r=n[0],i=n[1],s=n.slice(2).join("."),o=this.packages[i];o||(o={},this.packages[i]=o);var u=o[s];if(!u){var a=function(){},f={clazzName:t,superClazz:null,subClazz:null};a.prototype={},u={_class:a,_constructor:e[1],_category:{},_composition:f},a.prototype._=u,a.prototype._super=this._super,this.inheritance[t]=f,o[s]=u}var l=e[1],c=e[2],h=u._class.prototype;for(p in c){var d=c[p];h[p]=d}return c&&(u._category[l]=c),this.pullDown(u),this.pushDown(u),u},lookup:function(){var e=arguments;if(e.length==0)throw"missing arguments";var t=e[0],n=t.split("."),r=n[0],i=n[1],s=n.slice(2).join("."),o=this.packages[i];o||(o={},this.packages[i]=o);var u=o[s];if(!u){var a=function(){};a.prototype={};var f={clazzName:t,superClazz:null,subClazz:null};u={_class:a,_constructor:e[1],_category:{},_composition:f},this.inheritance[t]=f,o[s]=u}return u},extend:function(){var e=arguments,t=this.lookup(e[1]),n=this.lookup(e[0]);return t._composition.subClazz||(t._composition.subClazz={}),t._composition.subClazz[e[0]]=n,n._composition.superClazz=t,this.pullDown(n),n},composition:function(){var e=arguments[0],t=this.pdefsp(e);return t},pushDown:function(e){if(!e._composition.subClazz)return;for(var t in e._composition.subClazz){var n=e._composition.subClazz[t];this.pullDown(n),this.pushDown(n)}return e},pullDown:function(e){if(!e._composition.superClazz)return;var t=[];t.push(e);var n={},r=e;for(;;){r=r._composition.superClazz;if(!r)break;t.push(r)}var i=e._class.prototype,s=[],o={};for(var u=t.length-1;u>=0;u--){var a=t[u]._composition.clazzName,f=t[u]._constructor;s.push(f);var l={};for(var c in t[u]._category){var h=a+"#"+c,d=t[u]._category[c];for(p in d){var v=d[p];i[p]=v,l[p]=v}}o[a]=l}return e._constructors=s,e._superCategory=o,e},slicer:Array.prototype.slice,create:function(){var e=arguments;if(e.length==0)throw"missing arguments";var t=this.slicer.apply(arguments,[1]),n=e[0],r=this.pdefsp(n);if(!r)throw"clazz "+n+" does not exist";var i=new r._class,s=r._constructors;if(s)for(var o=0;o<s.length;o++)s[o].apply(i,t);else r._constructor.apply(i,t);return i},createWithPdefsp:function(){var e=arguments;if(e.length==0)throw"missing arguments";var t=arguments[1],n=e[0];if(!n)throw"clazz does not exist";var r=new n._class,i=n._constructors;if(i)for(var s=0;s<i.length;s++)i[s].apply(r,t);else n._constructor.apply(r,t);return r},construct:function(){var e=arguments;if(e.length!=2)throw"missing arguments";var t=e[0],n=e[1],r=this.pdefsp(t);if(!r)throw"clazz "+t+" does not exist";var i=new r._class,s=r._constructors;if(s)for(var o=0;o<s.length;o++)s[o].apply(i,instargs);else r._constructor.apply(i,instargs);return i},builder:function(){var e=arguments;if(e.length==0)throw"missing arguments";var t=e[0],n=this.pdefsp(t);if(!n)throw"clazz "+t+" does not exist";return n._builder?n._builder:(n._builder=function(){var e=arguments,t=new n._class,r=n._constructors;if(r)for(var i=0;i<r.length;i++)r[i].apply(t,e);else n._constructor.apply(t,e);return t},n._builder)},builderFromPdefsp:function(){var e=arguments;if(e.length==0)throw"missing arguments";var t=e[0];if(!t)throw"clazz does not exist";return t._builder?t._builder:(t._builder=function(){var e=arguments,n=new t._class,r=t._constructors;if(r)for(var i=0;i<r.length;i++)r[i].apply(n,e);else t._constructor.apply(n,e);return n},t._builder)},global:function(){if(arguments.length==0)return this.globals;var e=arguments[0];return arguments.length==2&&(this.globals[e]=arguments[1]),this.globals[e]}};var d=new h,v=d,m=function(e){this.manager=null;for(p in e)this[p]=e[p]};m.prototype={setState:function(e){return this.state=e,this.manager.postChange(this.bundle,this.instance,this.state),this.state},getState:function(){return this.state}};var g=function(e,t,n){this.config=e,this.callback=t,this.fired=!1,this.info=n};g.prototype={execute:function(e,t,n,r){var i=this;if(i.fired)return;for(p in i.config["Import-Bundle"]){var s=e.stateForBundleSources[p];if(!s||s.state!=1){e.log("trigger not fired due "+p+" for "+r||this.info);return}}i.fired=!0,e.log("posting trigger");var o=this.callback;window.setTimeout(function(){o(e)},0)}},v.define("Oskari.BundleManager",function(){this.serial=0,this.impls={},this.sources={},this.instances={},this.bundles={},this.stateForBundleDefinitions={},this.stateForBundleSources={},this.stateForBundles={},this.stateForBundleInstances={},this.triggers=[],this.loaderStateListeners=[]},{purge:function(){for(var e in this.sources)delete this.sources[e];for(var e in this.stateForBundleDefinitions)delete this.stateForBundleDefinitions[e].loader;for(var e in this.stateForBundleSources)delete this.stateForBundleSources[e].loader},notifyLoaderStateChanged:function(e,t){if(this.loaderStateListeners.length==0)return;for(var n=0;n<this.loaderStateListeners.length;n++){var r=this.loaderStateListeners[n];r(e,t)}},registerLoaderStateListener:function(e){this.loaderStateListeners.push(e)},alert:function(e){s(e)},log:function(e){s(e)},self:function(){return this},install:function(e,t,n,r){var i=this,s=e,o=i.stateForBundleDefinitions[s];o?(o.state=1,i.log("SETTING STATE FOR BUNDLEDEF "+s+" existing state to "+o.state)):(o={state:1},i.stateForBundleDefinitions[s]=o,i.log("SETTING STATE FOR BUNDLEDEF "+s+" NEW state to "+o.state)),o.metadata=r,i.impls[s]=t,i.sources[s]=n;var u=i.stateForBundleSources[s];u&&(u.state==-1?(i.log("triggering loadBundleSources for "+s+" at loadBundleDefinition"),window.setTimeout(function(){i.loadBundleSources(s)},0)):i.log("source state for "+s+" at loadBundleDefinition is "+u.state)),i.postChange(null,null,"bundle_definition_loaded")},installBundleClass:function(e,t){var n=v.metadata(t),r=v.builder(t),i=n.meta.source,s=n.meta.bundle;this.install(e,r,i,s)},installBundlePdefsp:function(e,t){var n=v.builderFromPdefsp(t),r=t._metadata,i={};this.install(e,n,i,r)},impl:function(e){return this.impls[e]},postChange:function(e,t,n){var r=this;r.update(e,t,n);for(bid in r.bundles){var s=r.bundles[bid];s.update(r,e,t,n)}for(i in r.instances){var s=r.instances[i];if(!s)continue;s.update(r,e,t,n)}},createBundle:function(e,t){var n=e,r=this,i=r.stateForBundleDefinitions[n];if(!i)throw"INVALID_STATE: for createBundle / definition not loaded "+e+"/"+t;var s=this.impls[e];if(!s){alert("this.impls["+e+"] is null!");return}var o=s(i);return this.bundles[t]=o,this.stateForBundles[t]={state:!0,bundlImpl:n},this.postChange(o,null,"bundle_created"),o},update:function(e,t,n){var r=this;r.log("update called with info "+n);for(var i=0;i<r.triggers.length;i++){var s=r.triggers[i];s.execute(r)}},bundle:function(e){return this.bundles[e]},destroyBundle:function(e){},uninstall:function(e){var t=this.impls[e];return t},createInstance:function(e){var t=this;if(!t.stateForBundles[e]||!t.stateForBundles[e].state)throw"INVALID_STATE: for createInstance / definition not loaded "+e;var n=""+ ++this.serial,r=this.bundles[e],i=r.create();return i.mediator=new m({bundleId:e,instanceid:n,state:"initial",bundle:r,instance:i,manager:this,clazz:v,requestMediator:{}}),this.instances[n]=i,this.stateForBundleInstances[n]={state:!0,bundleid:e},this.postChange(r,i,"instance_created"),i},instance:function(e){return this.instances[e]},destroyInstance:function(e){var t=this.instances[e],n=t.mediator;return n.bundle=null,n.manager=null,n.clazz=null,t.mediator=null,this.instances[e]=null,t=null,t},on:function(e,t,n){this.triggers.push(new g(e,t,n))}}),v.define("Oskari.BundleFacade",function(e){this.manager=e,this.bundles={},this.bundleInstances={},this.appSetup=null,this.bundlePath="",this.appConfig={}},{getBundleInstanceByName:function(e){var t=this;return t.bundleInstances[e]},getBundleInstanceConfigurationByName:function(e){var t=this;return t.appConfig[e]},setConfiguration:function(e){this.appConfig=e},getConfiguration:function(){return this.appConfig}});var y=v.create("Oskari.BundleManager");y.clazz=v;var b=v.create("Oskari.BundleFacade",y),w=v.global;v.define("Oskari.DomManager",function(e){this.$=e},{getEl:function(e){return this.$(e)},getElForPart:function(e){throw"N/A"},setElForPart:function(e,t){throw"N/A"},setElParts:function(e){throw"N/A"},getElParts:function(){throw"N/A"},pushLayout:function(e){throw"N/A"},popLayout:function(e){throw"N/A"},getLayout:function(){throw"N/A"}});var E=v.create("Oskari.DomManager"),S=0,x=0,T=0;v.define("Oskari.ModuleSpec",function(e,t){this.cs=v,this.clazzInfo=e,this.clazzName=t},{slicer:Array.prototype.slice,category:function(e,t){var n=v.category(this.clazzName,t||["__",++x].join("_"),e);return this.clazzInfo=n,this},methods:function(e,t){var n=v.category(this.clazzName,t||["__",++x].join("_"),e);return this.clazzInfo=n,this},extend:function(e){var t=v.extend(this.clazzName,e.length?e:[e]);return this.clazzInfo=t,this},create:function(){return v.createWithPdefsp(this.clazzInfo,arguments)},name:function(){return this.clazzName},metadata:function(){return v.metadata(this.clazzName)},events:function(e){var t=this;return t.category({eventHandlers:e,onEvent:function(e){var t=this.eventHandlers[e.getName()];if(!t)return;return t.apply(this,[e])}},"___events"),t},requests:function(e){var t=this;return t.category({requestHandlers:e,onRequest:function(e){var t=this.requestHandlers[e.getName()];if(!t)return;return t.apply(this,[e])}},"___requests"),t},builder:function(){return v.builderFromPdefsp(this.clazzInfo)}});var N={VERSION:"2.0.0",bundle_manager:y,bundle_facade:b,bundle_locale:u,app:b,clazz:v,$:function(){return w.apply(v,arguments)},run:function(e){e()},setLoaderMode:function(e){f=e},getLoaderMode:function(){return f},setDebugMode:function(e){t=e},setSupportBundleAsync:function(e){a=e},getSupportBundleAsync:function(){return a},setBundleBasePath:function(e){basePathForBundles=e},getBundleBasePath:function(){return basePathForBundles},setPreloaded:function(e){l=e},getPreloaded:function(){return l},registerLocalization:function(e){if(!e.length)return u.setLocalization(e.lang,e.key,e.value);for(var t=0;t<e.length;t++){var n=e[t];u.setLocalization(n.lang,n.key,n.value)}},getLocalization:function(e){return u.getLocalization(e)},getLang:function(){return u.getLang()},setLang:function(e){return u.setLang(e)},purge:function(){y.purge(),v.purge("Oskari")},getDomManager:function(){return E},setDomManager:function(e){E=e},getSandbox:function(e){return w.apply(v,[e||"sandbox"])},setSandbox:function(e,t){return w.apply(v,[e||"sandbox",t])},registerMimeTypeToPlugin:function(e,t){blMimeTypeToPlugin[e]=t},cls:function(e,t,n,r){var i=undefined;return e==undefined?e=["Oskari","_",++S].join("."):i=v.lookup(e),i&&i._constructor&&!t||(i=v.define(e,t||function(){},n,r||{})),v.create("Oskari.ModuleSpec",i,e)},sandbox:function(e){var t={sandbox:w.apply(v,[e||"sandbox"])};return t.on=function(e){var t=this;if(e.eventHandlers)for(p in e.eventHandlers)t.sandbox.registerForEventByName(e,p);if(e.requestHandlers)for(r in e.requestHandlers)t.sandbox.addRequestHandler(r,reqHandlers[r])},t.off=function(e){if(e.eventHandlers)for(p in e.eventHandlers)me.sandbox.unregisterFromEventByName(e,p);if(e.requestHandlers)for(r in e.requestHandlers)me.sandbox.removeRequestHandler(r,reqHandlers[r])},t.slicer=Array.prototype.slice,t.notify=function(e){var t=this,n=t.sandbox,r=t.sandbox.getEventBuilder(e),i=t.slicer.apply(arguments,[1]),s=eventBuilder.apply(eventBuilder,i);return n.notifyAll(s)},t},loc:function(){return N.registerLocalization.apply(N,arguments)},setConfiguration:function(e){return b.setConfiguration(e)},getConfiguration:function(){return b.getConfiguration()}};N.eventCls=function(e,t,n){var r=["Oskari","event","registry",e].join("."),i=N.cls(r,t,n,{protocol:["Oskari.mapframework.event.Event"]});return i.category({getName:function(){return e}},"___event"),i.eventName=e,i},N.requestCls=function(e,t,n){var r=["Oskari","request","registry",e].join("."),i=N.cls(r,t,n,{protocol:["Oskari.mapframework.request.Request"]});return i.category({getName:function(){return e}},"___request"),i.requestName=e,i},N._baseClassFor={extension:"Oskari.userinterface.extension.EnhancedExtension",bundle:"Oskari.mapframework.bundle.extension.ExtensionBundle",tile:"Oskari.userinterface.extension.EnhancedTile",flyout:"Oskari.userinterface.extension.EnhancedFlyout",view:"Oskari.userinterface.extension.EnhancedView"},N.extensionCls=function(e){return N.cls(e).extend(this._baseClassFor.extension)},N.bundleCls=function(e,t){e||(e=["__",++T].join("_"));var n=N.cls(t,function(){},{update:function(){}},{protocol:["Oskari.bundle.Bundle",this._baseClassFor.bundle],manifest:{"Bundle-Identifier":e}});return y.installBundlePdefsp(e,n.clazzInfo),n.___bundleIdentifier=e,n.loc=function(e){return e.key=this.___bundleIdentifier,N.registerLocalization(e),n},n.start=function(e){var t=this.___bundleIdentifier;if(!b.bundles[t]){var n=y.createBundle(t,t);b.bundles[t]=n}var r=y.createInstance(t);b.bundleInstances[t]=r;var i=b.getBundleInstanceConfigurationByName(t);if(i)for(ip in i)r[ip]=i[ip];return r.start(),r},n.stop=function(){var e=this.___bundleIdentifier,t=b.bundleInstances[e];return t.stop()},n},N.flyoutCls=function(e){return N.cls(e).extend(this._baseClassFor.flyout)},N.tileCls=function(e){return N.cls(e).extend(this._baseClassFor.tile)},N.viewCls=function(e){return N.cls(e).extend(this._baseClassFor.view)},w.apply(v,["Oskari",N]),e.Oskari=N,define("oskari",["exports"],function(e){return e.Oskari=N,N})})(),define("normalize",["require","module"],function(e,t){function o(e,t,n){if(e.indexOf("data:")===0)return e;e=r(e);if(e.match(/^\//)||e.match(s))return e;var i=n.match(s),o=t.match(s);return o&&(!i||i[1]!=o[1]||i[2]!=o[2])?u(e,t):a(u(e,t),n)}function u(e,t){e.substr(0,2)=="./"&&(e=e.substr(2));var n=t.split("/"),r=e.split("/");n.pop();while(curPart=r.shift())curPart==".."?n.pop():n.push(curPart);return n.join("/")}function a(e,t){var n=t.split("/");n.pop(),t=n.join("/")+"/",i=0;while(t.substr(i,1)==e.substr(i,1))i++;while(t.substr(i,1)!="/")i--;t=t.substr(i+1),e=e.substr(i+1),n=t.split("/");var r=e.split("/");out="";while(n.shift())out+="../";while(curPart=r.shift())out+=curPart+"/";return out.substr(0,out.length-1)}var n=/([^:])\/+/g,r=function(e){return e.replace(n,"$1/")},s=/[^\:\/]*:\/\/([^\/])*/,f=function(e,t,n,i){t=r(t),n=r(n);var s=/@import\s*("([^"]*)"|'([^']*)')|url\s*\(\s*(\s*"([^"]*)"|'([^']*)'|[^\)]*\s*)\s*\)/ig,u,a,e;while(u=s.exec(e)){a=u[3]||u[2]||u[5]||u[6]||u[4];var f;i&&a.substr(0,1)=="/"?f=i+a:f=o(a,t,n);var l=u[5]||u[6]?1:0;e=e.substr(0,s.lastIndex-a.length-l-1)+f+e.substr(s.lastIndex-l-1),s.lastIndex=s.lastIndex+(f.length-a.length)}return e};return f.convertURIBase=o,f}),define("css",["./normalize"],function(e){function t(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}if(typeof window=="undefined")return{load:function(e,t,n){n()}};var n=!1,r=document.getElementsByTagName("head")[0],i=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)/),s=!1;!i||(i[1]||i[7]?(s=parseInt(i[1])<6||parseInt(i[7])<=9,i="trident"):i[2]?(s=!0,i="webkit"):i[3]||(i[4]?(s=parseInt(i[4])<18,i="gecko"):n&&alert("Engine detection failed")));var o={},u=/^\/|([^\:\/]*:)/;o.pluginBuilder="./css-builder";var a=[],f={},l=[];o.addBuffer=function(e){if(t(a,e)!=-1)return;if(t(l,e)!=-1)return;a.push(e),l.push(e)},o.setBuffer=function(t,n){var r=window.location.pathname.split("/");r.pop(),r=r.join("/")+"/";var i=require.toUrl("base_url").split("/");i.pop();var s=i.join("/")+"/";s=e.convertURIBase(s,r,"/"),s.match(u)||(s="/"+s),s.substr(s.length-1,1)!="/"&&(s+="/"),o.inject(e(t,s,r));for(var l=0;l<a.length;l++)(n&&a[l].substr(a[l].length-5,5)==".less"||!n&&a[l].substr(a[l].length-4,4)==".css")&&(function(e){f[e]=f[e]||!0,setTimeout(function(){typeof f[e]=="function"&&f[e](),delete f[e]},7)}(a[l]),a.splice(l--,1))},o.attachBuffer=function(e,n){for(var r=0;r<a.length;r++)if(a[r]==e)return f[e]=n,!0;if(f[e]===!0)return f[e]=n,!0;if(t(l,e)!=-1)return n(),!0};var c=function(e,t){setTimeout(function(){for(var n=0;n<document.styleSheets.length;n++){var r=document.styleSheets[n];if(r.href==e.href)return t()}c(e,t)},10)},h=function(e,t){setTimeout(function(){try{return e.sheet.cssRules,t()}catch(n){}h(e,t)},10)};if(i=="trident"&&s)var p=[],d=[],v=0,m=function(e,t){var n;d.push({url:e,cb:t}),n=p.shift(),!n&&v++<31&&(n=document.createElement("style"),r.appendChild(n)),n&&g(n)},g=function(e){var t=d.shift();if(!t){e.onload=b,p.push(e);return}e.onload=function(){t.cb(t.ss),g(e)};var n=e.styleSheet;t.ss=n.imports[n.addImport(t.url)]};var y=function(e){var t=document.createElement("link");return t.type="text/css",t.rel="stylesheet",t.href=e,t},b=function(){};o.linkLoad=function(e,t){var o=setTimeout(function(){n&&alert("timeout"),t()},L*1e3-100),u=function(){clearTimeout(o),a&&(a.onload=b),setTimeout(t,7)};if(!s){var a=y(e);a.onload=u,r.appendChild(a)}else if(i=="webkit"){var a=y(e);c(a,u),r.appendChild(a)}else if(i=="gecko"){var f=document.createElement("style");f.textContent='@import "'+e+'"',h(f,u),r.appendChild(f)}else i=="trident"&&m(e,u)};var w=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],E={},S=function(e,t,n){if(E[e]){t(E[e]);return}var r,i,s;if(typeof XMLHttpRequest!="undefined")r=new XMLHttpRequest;else if(typeof ActiveXObject!="undefined")for(i=0;i<3;i+=1){s=w[i];try{r=new ActiveXObject(s)}catch(o){}if(r){w=[s];break}}r.open("GET",e,requirejs.inlineRequire?!1:!0),r.onreadystatechange=function(i){var s,o;r.readyState===4&&(s=r.status,s>399&&s<600?(o=new Error(e+" HTTP status: "+s),o.xhr=r,n(o)):(E[e]=r.responseText,t(r.responseText)))},r.send(null)},x=0,T;o.inject=function(e){x<31&&(T=document.createElement("style"),T.type="text/css",r.appendChild(T),x++),T.styleSheet?T.styleSheet.cssText+=e:T.appendChild(document.createTextNode(e))};var N=/@import\s*(url)?\s*(('([^']*)'|"([^"]*)")|\(('([^']*)'|"([^"]*)"|([^\)]*))\))\s*;?/g,C=window.location.pathname.split("/");C.pop(),C=C.join("/")+"/";var k=function(t,n,r){t.match(u)||(t="/"+e.convertURIBase(t,C,"/")),S(t,function(i){i=e(i,t,C);var s=[],o=[],u=[],a;while(a=N.exec(i)){var f=a[4]||a[5]||a[7]||a[8]||a[9];s.push(f),o.push(N.lastIndex-a[0].length),u.push(a[0].length)}var l=0;for(var c=0;c<s.length;c++)(function(e){k(s[e],function(t){i=i.substr(0,o[e])+t+i.substr(o[e]+u[e]);var r=t.length-u[e];for(var a=e+1;a<s.length;a++)o[a]+=r;l++,l==s.length&&n(i)},r)})(c);s.length==0&&n(i)},r)};o.normalize=function(e,t){return e.substr(e.length-4,4)==".css"&&(e=e.substr(0,e.length-4)),t(e)};var L,A=!1;return o.load=function(e,t,r,i,u){L=L||i.waitSeconds||7;var a=e+(u?".less":".css");if(o.attachBuffer(a,r))return;var f=t.toUrl(a);!A&&n&&(alert(s?"hacking links":"not hacking"),A=!0),u?k(f,function(e){u&&(e=u(e,function(e){o.inject(e),setTimeout(r,7)}))}):o.linkLoad(f,r)},n&&(o.inspect=function(){if(stylesheet.styleSheet)return stylesheet.styleSheet.cssText;if(stylesheet.innerHTML)return stylesheet.innerHTML}),o}),define("bundles/oskari/oskari-with-loader",["oskari","jquery","exports","css"],function(Oskari,$,exports){function buildPathForLoaderMode(e,t){var n=pathBuilders[Oskari.getLoaderMode()];return n?n(e,t):basePathForBundles?basePathForBundles+e:e}function isPackedMode(){return!isNotPackMode[Oskari.getLoaderMode()]}function buildPathForPackedMode(e){return e+"/build/"+Oskari.getLoaderMode()+".js"}function buildBundlePathForPackedMode(e){return e+"/build/bundle-"+Oskari.getLoaderMode()+".js"}function buildLocalePathForPackedMode(e){return e+"/build/"+Oskari.getLoaderMode()+"-locale-"+Oskari.bundle_locale.getLang()+".js"}Oskari.VERSION="1.13";var instTs=(new Date).getTime(),basePathForBundles=null,pathBuilders={"default":function(e,t){return basePathForBundles?basePathForBundles+e:e},dev:function(e,t){return basePathForBundles?basePathForBundles+e+"?ts="+instTs:e+"?ts="+instTs}},isNotPackMode={dev:!0,"default":!0,"static":!0},bundle_loader_id=0,blMimeTypeToPlugin={"text/javascript":function(e){return e},"text/css":function(e){return"css!"+e}};return Oskari.clazz.define("Oskari.BundleLoader",function(e,t){this.loader_identifier=++bundle_loader_id,this.manager=e,this.callback=t,this.filesRequested=0,this.filesLoaded=0,this.files={},this.fileList=[],this.metadata={},this.mimeTypeToPlugin=blMimeTypeToPlugin},{add:function(e,t){var n=this,r=(t?t.type:null)||"text/javascript";if(!n.files[e]){var i={src:n.mimeTypeToPlugin[r](e),type:r,id:t?t.id:null,state:!1};n.files[e]=i,"text/javascript"===i.type&&n.filesRequested++,n.fileList.push(i)}},getState:function(){return this.filesRequested==0?1:this.filesLoaded/this.filesRequested},config:function(e){require.config(e)},commit:function(){var e=document.getElementsByTagName("head")[0],t=document.createDocumentFragment(),n=this,r=this.filesRequested;if(r==0){n.callback(),n.manager.notifyLoaderStateChanged(n,!0);return}if(Oskari.getPreloaded()){n.callback(),n.manager.notifyLoaderStateChanged(n,!0);return}var i=[];for(var s=0;s<n.fileList.length;s++){var o=n.fileList[s],u=o.src;i.push(u)}require(i,function(){n.callback(),n.manager.notifyLoaderStateChanged(n,!0)})}}),Oskari.clazz.category("Oskari.BundleManager","loader_1_x",{loadBundleDefinition:function(e,t,n){var r=this,i=e;r.log("loadBundleDefinition called with "+i);var s=r.stateForBundleDefinitions[i];if(s){if(s.state==1){r.log("bundle definition already loaded for "+i),r.postChange(null,null,"bundle_definition_loaded");return}r.log("bundle definition already loaded OR WHAT?"+i+" "+s.state);return}s={state:-1},r.stateForBundleDefinitions[i]=s,r.log("set NEW state for DEFINITION "+i+" to "+s.state),s.bundleSrcPath=t;var o=n||t.substring(0,t.lastIndexOf("/"));s.bundlePath=o;var u=Oskari.clazz.create("Oskari.BundleLoader",this,function(){r.log("bundle_def_loaded_callback")});u.metadata.context="bundleDefinition",s.loader=u,u.add(t),u.commit()},loadBundleSources:function(e){var t=this,n=e;t.log("loadBundleSources called with "+n);var r=t.stateForBundleDefinitions[n];if(!r)throw"INVALID_STATE: bundle definition load not requested for "+n;r&&t.log("- definition STATE for "+n+" at load sources "+r.state);if(Oskari.getLoaderMode()=="static"){t.postChange(null,null,"bundle_definition_loaded");return}var i=t.stateForBundleSources[n];if(i){if(i.state==1){t.log("already loaded sources for : "+n);return}if(i.state!=-1)throw"INVALID_STATE: at "+n;t.log("loading previously pending sources for "+n+" "+i.state+" or what?")}else i={state:-1},t.stateForBundleSources[n]=i,t.log("setting STATE for sources "+n+" to "+i.state);if(r.state!=1){t.log("pending DEFINITION at sources for "+n+" to "+r.state+" -> postponed");return}t.log("STARTING load for sources "+n);var s={count:0,loaded:0,files:{},config:{},require:[]},t=this,o=function(){t.log("finished loading "+s.count+" files for "+n+"."),t.stateForBundleSources[n].state=1,t.log("set NEW state post source load for "+n+" to "+t.stateForBundleSources[n].state),t.postChange(null,null,"bundle_sources_loaded")},u=r.bundlePath,a=t.sources[n];if(a){t.log("got sources for "+n);for(p in a)if(p=="scripts"){var f=a[p];for(var l=0;l<f.length;l++){var c=f[l];s.count++;var h=buildPathForLoaderMode(c.src,u),d=null;h.indexOf("http")!=-1?d=h:d=u+"/"+h,s.files[d]=c}}else if(p=="locales"){var v=Oskari.bundle_locale.getLang(),f=a[p];for(var l=0;l<f.length;l++){var c=f[l];if(v&&c.lang&&c.lang!=v)continue;s.count++;var h=buildPathForLoaderMode(c.src,u),d=null;h.indexOf("http")!=-1?d=h:d=u+"/"+h,s.files[d]=c}}else if(p=="requirements"){var f=a[p],m=f.require;s.config=f.config||{},s.config.paths||(s.config.paths={});if(f.aliases)for(var g in f.aliases)s.config.paths[g]=u+"/"+f.aliases[g];for(var l=0;l<m.length;l++){var c=m[l];s.require.push(c)}}}else t.log("NO sources for "+n);var y=Oskari.clazz.create("Oskari.BundleLoader",this,o);y.metadata.context="bundleSources",y.metadata.bundleImpl=n,i.loader=y;if(isPackedMode()){var b=0;for(js in s.files)b++;if(b>0){var w=buildPathForPackedMode(u);y.add(w,"text/javascript"),t.log("- added PACKED javascript source "+w+" for "+n);var E=buildLocalePathForPackedMode(u);y.add(E,"text/javascript"),t.log("- added PACKED locale javascript source "+E+" for "+n)}}else{for(js in s.files)y.add(js,s.files[js]),t.log("- added script source "+js+" for "+n);for(var S=0;S<s.require.length;S++)y.add(s.require[S],s.require[S]),t.log("- added require "+s.require[S]+" for "+n)}y.config(s.config),y.commit()}}),Oskari.clazz.category("Oskari.BundleFacade","loader_1_x",{requireBundle:function(e,t,n){var r=this,i=r.manager.createBundle(e,t);n(r.manager,i)},require:function(e,t,n){var r=this;r.manager.on(e,t,n);var i=e["Import-Bundle"];for(p in i){var s=p,o=i[p],u=o.bundlePath||r.bundlePath;if(isPackedMode()){var a=buildBundlePathForPackedMode(u+s);bundleDefFilename=buildPathForLoaderMode(a,u)}else bundleDefFilename=buildPathForLoaderMode(u+s+"/bundle.js",u);r.manager.log("FACADE requesting load for "+s+" from "+bundleDefFilename),r.manager.loadBundleDefinition(s,bundleDefFilename,u+s),r.manager.loadBundleSources(s)}},setBundlePath:function(e){this.bundlePath=e},loadBundleDeps:function(e,t,n,r){var i=this,s=e["Import-Bundle"],o=[],u=!1;for(p in s){var a=p,f=s[p];o.push({name:a,def:f,phase:f.phase}),u=u||f.phase}o.sort(function(e,t){return!e.phase&&!t.phase?0:e.phase?t.phase?e.phase<t.phase?-1:1:-1:1}),u||!Oskari.getSupportBundleAsync()?i.loadBundleDep(o,t,n,r):i.loadBundleDepAsync(e,t,n,r)},loadBundleDep:function(e,t,n,r){var i=this,s=e.pop();if(!s){t(n);return}var o=s.def,u=s.name,a=this,f={"Import-Bundle":{}};f["Import-Bundle"][u]=o,a.require(f,function(n){i.loadBundleDep(e,t,n,r)},r)},loadBundleDepAsync:function(e,t,n,r){var i=this,s=this;s.require(e,t,r)},playBundle:function(e,t){var n=e.metadata,r=e.bundlename,i=e.bundleinstancename,s=n.Singleton,o=this,u=this,a=n["Require-Bundle-Instance"]||[],f=e.instanceProps;u.loadBundleDeps(n,function(e){for(var n=0;n<a.length;n++){var l=a[n],c=typeof l=="object"?l.bundlename:l,h=typeof l=="object"?l.bundleinstancename:l+"Instance",p=u.bundles[c];p||(p=e.createBundle(c,h),u.bundles[c]=p);var d=u.bundleInstances[h];if(!d||!s){d=e.createInstance(h),u.bundleInstances[h]=d;var v=u.getBundleInstanceConfigurationByName(h);if(v)for(ip in v)d[ip]=v[ip];d.start()}}o.requireBundle(r,i,function(){var n=e.createInstance(i);for(ip in f)n[ip]=f[ip];var r=u.getBundleInstanceConfigurationByName(i);if(r)for(ip in r)n[ip]=r[ip];n.start(),u.bundleInstances[i]=n,t(n)})},o.manager,r)},startApplication:function(cb){function schedule(){window.setTimeout(mediator.player,0)}var me=this,appSetup=this.appSetup,appConfig=this.appConfig,seq=this.appSetup.startupSequence.slice(0),seqLen=seq.length,startupInfo={bundlesInstanceConfigurations:appConfig,bundlesInstanceInfos:{}},mediator={facade:me,seq:seq,bndl:null,player:null,startupInfo:startupInfo};mediator.player=function(){mediator.bndl=mediator.seq.shift();if(mediator.bndl==null){cb&&cb(startupInfo);return}mediator.facade.playBundle(mediator.bndl,function(bi){var bndlName=mediator.bndl.bundlename,bndlInstanceName=mediator.bndl.bundleinstancename;mediator.startupInfo.bundlesInstanceInfos[bndlInstanceName]={bundlename:bndlName,bundleinstancename:bndlInstanceName,bundleInstance:bi},mediator.bndl.callback&&(typeof mediator.bndl.callback=="string"&&eval(mediator.bndl.callback),mediator.bndl.callback.apply(this,[bi,bndl])),schedule()})},schedule()},stopApplication:function(){throw"NYI"},setApplicationSetup:function(e){this.appSetup=e},getApplicationSetup:function(){return this.appSetup}}),exports.Oskari=Oskari,Oskari});
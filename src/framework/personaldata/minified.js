Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.PersonalDataBundleInstance",function(){this.core=null,this.sandbox=null,this.started=!1,this.template=null,this.plugins={},this.viewService=null},{__name:"PersonalData",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},getViewService:function(){return this.viewService},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},start:function(){var e=this;if(e.started)return;e.started=!0;var t=this.conf,n=(t?t.sandbox:null)||"sandbox",r=Oskari.getSandbox(n),i;e.sandbox=r,this.viewService=Oskari.clazz.create("Oskari.mapframework.bundle.personaldata.service.ViewService",r.getAjaxUrl()),r.register(e);for(i in e.eventHandlers)e.eventHandlers.hasOwnProperty(i)&&r.registerForEventByName(e,i);var s=r.getRequestBuilder("userinterface.AddExtensionRequest")(this);r.request(this,s),e.createUi(),this.requestHandlers={addTabRequestHandler:Oskari.clazz.create("Oskari.mapframework.bundle.personaldata.request.AddTabRequestHandler",r,this.plugins["Oskari.userinterface.Flyout"])},r.addRequestHandler("PersonalData.AddTabRequest",this.requestHandlers.addTabRequestHandler)},init:function(){return null},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(!t)return;return t.apply(this,[e])},eventHandlers:{},stop:function(){var e=this.sandbox(),t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.unregisterFromEventByName(this,t);e.removeRequestHandler("PersonalData.AddTabRequest",this.requestHandlers.addTabRequestHandler);var n=e.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);e.request(this,n),this.sandbox.unregister(this),this.started=!1},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.personaldata.Flyout",this),this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.mapframework.bundle.personaldata.Tile",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null,this.plugins["Oskari.userinterface.Tile"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},createUi:function(){var e=this;this.plugins["Oskari.userinterface.Flyout"].createUi(),this.plugins["Oskari.userinterface.Tile"].refresh()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]}),define("bundles/framework/bundle/personaldata/instance",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.Flyout",function(e){this.instance=e,this.container=null,this.state=null,this.template=null,this.templateTabHeader=null,this.templateTabContent=null,this.tabsData=[]},{getName:function(){return"Oskari.mapframework.bundle.personaldata.Flyout"},setEl:function(e,t,n){this.container=e[0],jQuery(this.container).hasClass("personaldata")||jQuery(this.container).addClass("personaldata")},startPlugin:function(){var e=this,t=e.instance.getLocalization("tabs");this.tabsData={myViews:Oskari.clazz.create("Oskari.mapframework.bundle.personaldata.MyViewsTab",e.instance,t.myviews),publishedMaps:Oskari.clazz.create("Oskari.mapframework.bundle.personaldata.PublishedMapsTab",e.instance,t.publishedmaps),account:Oskari.clazz.create("Oskari.mapframework.bundle.personaldata.AccountTab",e.instance,t.account)}},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(e){this.state=e},createUi:function(){var e=this,t=e.instance.getSandbox(),n=jQuery(this.container),r,i,s;n.empty(),this.tabsContainer=Oskari.clazz.create("Oskari.userinterface.component.TabContainer",this.instance.getLocalization("notLoggedIn")),this.tabsContainer.insertTo(n);if(!t.getUser().isLoggedIn())return;for(r in this.tabsData)this.tabsData.hasOwnProperty(r)&&(i=this.tabsData[r],s=Oskari.clazz.create("Oskari.userinterface.component.TabPanel"),s.setTitle(i.getTitle()),i.addTabContent(s.getContainer()),i.bindEvents&&i.bindEvents(),this.tabsContainer.addPanel(s))},addTab:function(e){var t=this.instance.getSandbox(),n;if(!t.getUser().isLoggedIn())return;n=Oskari.clazz.create("Oskari.userinterface.component.TabPanel"),n.setTitle(e.title),n.setContent(e.content),this.tabsContainer.addPanel(n,e.first)}},{protocol:["Oskari.userinterface.Flyout"]}),define("bundles/framework/bundle/personaldata/Flyout",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.Tile",function(e){this.instance=e,this.container=null,this.template=null},{getName:function(){return"Oskari.mapframework.bundle.personaldata.Tile"},setEl:function(e,t,n){this.container=jQuery(e)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){},getOptions:function(){},setState:function(e){},refresh:function(){}},{protocol:["Oskari.userinterface.Tile"]}),define("bundles/framework/bundle/personaldata/Tile",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.MyViewsTab",function(e,t){this.instance=e,this.loc=t,this.template=jQuery('<div class="viewsList volatile"></div>'),this.templateLink=jQuery('<a href="JavaScript:void(0);"></a>'),this.templateDesc=jQuery('<div class="oskarifield"><label for="description"></label><textarea id="view_description" name="description" placeholder="'+this.loc.popup.description_placeholder+'"></textarea></div>'),this.container=null;var n=e.sandbox,r=this,i=n.getRequestBuilder("StateHandler.SaveStateRequest"),s;if(i){s=n.getRequestBuilder("Toolbar.AddToolButtonRequest");var o="localization.button.toolbarsave";t&&t.button&&t.button.toolbarsave&&(o=t.button.toolbarsave),n.request(e,s("save_view","viewtools",{iconCls:"tool-save-view",tooltip:o,sticky:!1,prepend:!0,callback:function(){r._promptForView(function(t,r){var i=n.getRequestBuilder("StateHandler.SaveStateRequest");n.request(e,i(t,r))})}}))}n.getUser().isLoggedIn()||(s=n.getRequestBuilder("Toolbar.ToolButtonStateRequest"),n.request(e,s("save_view","viewtools",!1)))},{getName:function(){return"PersonalData.MyViews"},getTitle:function(){return this.loc.title},addTabContent:function(e){var t=this,n=t.template.clone();t.container=e,e.append(n),t._refreshViewsList()},_renderViewsList:function(e){e||(e=[]);var t=this,n=t.container.find(".viewsList");n.empty(),this.viewData=e;var r=this._getGridModel(e),i=this._getGrid(r);i.renderTo(n)},_refreshViewsList:function(){var e=this,t=e.instance.getViewService();t.loadViews("USER",function(t,n){t?e._renderViewsList(n.views):e._showErrorMessage(e.loc.error.loadfailed)})},_editView:function(e){var t=this,n=this.instance.getSandbox(),r=t.instance.getViewService(),i=function(n,i){r.updateView(e.id,n,i,function(e){if(e){var n=Oskari.clazz.create("Oskari.userinterface.component.Popup");n.show(t.loc.popup.title,t.loc.save.success),n.fadeout(),t._refreshViewsList()}else t._showErrorMessage(t.loc.error.notsaved)})};this._promptForView(i,e.name,e.description)},_promptForView:function(e,t,n){var r=this,i=Oskari.clazz.create("Oskari.userinterface.component.Form"),s=Oskari.clazz.create("Oskari.userinterface.component.FormInput","name");s.setPlaceholder(this.loc.popup.name_placeholder);var o=this.loc.popup.title;t&&(o=this.loc.popup.edit,s.setValue(t)),s.setRequired(!0,r.loc.save.error_noname),s.setContentCheck(!0,r.loc.save.error_illegalchars),i.addField(s);var u=i.getForm();u.append(r.templateDesc.clone()),n&&u.find("textarea").val(n);var a=Oskari.clazz.create("Oskari.userinterface.component.Popup"),f=Oskari.clazz.create("Oskari.userinterface.component.Button");f.setTitle(this.loc.button.save),f.addClass("primary");var l=this.instance.sandbox;f.setHandler(function(){var t=i.validate();t.length===0?(e(s.getValue(),u.find("textarea").val()),a.close()):i.showErrors()});var c=a.createCloseButton(this.loc.button.cancel);a.show(o,u,[c,f]),a.dialog.on("keyup",function(e){e.stopPropagation()}),a.dialog.on("keydown",function(e){e.stopPropagation()})},_getGridModel:function(e){var t=Oskari.clazz.create("Oskari.userinterface.component.GridModel"),n,r,i,s;t.setIdField("id");for(n=0;n<e.length;++n)r=e[n],i=r.isPublic===!0,s={id:r.id,state:r.state,name:r.name,description:r.description,isPublic:i,edit:this.loc.edit,publish:i?this.loc.unpublish:this.loc.publish,"delete":this.loc["delete"]},t.addData(s);return t},_getGrid:function(e){var t=this,n=this.instance,r=n.getSandbox(),i=["name","description","edit","delete"],s=Oskari.clazz.create("Oskari.userinterface.component.Grid");s.setDataModel(e),s.setVisibleFields(i);var o=function(e,i){var s=t.templateLink.clone();return s.append(e),s.bind("click",function(){var e=r.getRequestBuilder("StateHandler.SetStateRequest");if(e){var t=e(i.state);t.setCurrentViewId(i.id),r.request(n,t)}return!1}),s};s.setColumnValueRenderer("name",o);var u=function(e,n){var r=t.templateLink.clone();return r.append(e),r.bind("click",function(){var e=t._getViewById(n.id);return e&&t._editView(e),!1}),r};s.setColumnValueRenderer("edit",u);var a=function(e,n){var r=t.templateLink.clone();return r.append(e),r.bind("click",function(){var e=t._getViewById(n.id);return e&&t._confirmDelete(e),!1}),r};s.setColumnValueRenderer("delete",a);var f,l,c;for(f=0;f<i.length;++f)l=i[f],c="grid."+l,this.loc&&this.loc.grid&&this.loc.grid[l]&&(c=this.loc.grid[l]),s.setColumnUIName(l,c);return s},_getViewById:function(e){var t;for(t=0;t<this.viewData.length;++t)if(this.viewData[t].id==e)return this.viewData[t];this._showErrorMessage(this.loc.error.generic)},_confirmDelete:function(e){var t=this,n=Oskari.clazz.create("Oskari.userinterface.component.Popup"),r=Oskari.clazz.create("Oskari.userinterface.component.Button");r.setTitle(this.loc["delete"]),r.addClass("primary");var i=this.instance.sandbox;r.setHandler(function(){t._deleteView(e),n.close()});var s=n.createCloseButton(this.loc.button.cancel);n.show(t.loc.popup.deletetitle,t.loc.popup.deletemsg,[s,r]),n.makeModal()},_deleteView:function(e){var t=this,n=t.instance.getViewService();n.deleteView(e,function(e){e?t._refreshViewsList():t._showErrorMessage(t.loc.error.notdeleted)})},_showErrorMessage:function(e){var t=Oskari.clazz.create("Oskari.userinterface.component.Popup"),n=t.createCloseButton(this.loc.button.ok);n.addClass("primary"),t.show(this.loc.error.title,e,[n])},bindEvents:function(){var e=this.instance,t=e.getSandbox(),n;for(n in this.eventHandlers)this.eventHandlers.hasOwnProperty(n)&&t.registerForEventByName(this,n)},unbindEvents:function(){var e=this.instance,t=e.getSandbox(),n;for(n in this.eventHandlers)this.eventHandlers.hasOwnProperty(n)&&t.unregisterFromEventByName(this,n)},eventHandlers:{StateSavedEvent:function(e){if(e.isError()){this._showErrorMessage(this.loc.error.notsaved);return}var t=Oskari.clazz.create("Oskari.userinterface.component.Popup");t.show(this.loc.popup.title,this.loc.save.success),t.fadeout(),this._refreshViewsList()}},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(!t)return;return t.apply(this,[e])}}),define("bundles/framework/bundle/personaldata/MyViewsTab",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.service.ViewService",function(e){this._viewUrl=e},{__qname:"Oskari.mapframework.bundle.personaldata.service.ViewService",getQName:function(){return this.__qname},__name:"ViewService",getName:function(){return this.__name},loadViews:function(e,t){var n=this;e||(e="USER"),jQuery.ajax({url:n._viewUrl+"action_route=GetViews",data:{viewType:e},type:"POST",dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},success:function(e){t(!0,e)},error:function(){t(!1)}})},deleteView:function(e,t){var n=this;jQuery.ajax({url:n._viewUrl+"action_route=DeleteView",data:{id:e.id},type:"POST",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},success:function(e){t(!0)},error:function(){t(!1)}})},makeViewPublic:function(e,t,n){var r=this;jQuery.ajax({url:r._viewUrl+"action_route=AdjustViewAccess",data:{id:e,isPublic:t},type:"POST",dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},success:function(e){n(!0)},error:function(){n(!1)}})},updateView:function(e,t,n,r){var i=this;jQuery.ajax({url:i._viewUrl+"action_route=UpdateView",type:"POST",data:{id:e,newName:t,newDescription:n},dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},success:function(e){r(!0)},error:function(){r(!1)}})},isViewLayersLoaded:function(e,t){var n={status:!1,msg:"error"};if(e&&e.state&&e.state.mapfull&&e.state.mapfull.state&&e.state.mapfull.state.selectedLayers){var r=e.state.mapfull.state.selectedLayers,i=t.getService("Oskari.mapframework.service.MapLayerService"),s=i.getAllLayers(),o=i.isAllLayersLoaded(),u=!1,a,f;for(a=0;a<r.length;++a){f=i.findMapLayer(r[a].id,s);if(!f){u=!0;break}}o?u?n.msg="missing":(n.status=!0,n.msg="ok"):u?n.msg="notloaded":(n.status=!0,n.msg="ok")}return n}},{protocol:["Oskari.mapframework.service.Service"]}),define("bundles/framework/bundle/personaldata/service/ViewService",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.PublishedMapsTab",function(e,t){this.instance=e,this.template=jQuery('<div class="viewsList volatile"></div>'),this.templateLink=jQuery('<a href="JavaScript:void(0);"></a>'),this.loc=t,this.container=null},{getName:function(){return"PersonalData.PublishedMapsTab"},getTitle:function(){return this.loc.title},addTabContent:function(e){var t=this,n=t.template.clone();t.container=e,e.append(n),t._refreshViewsList()},_renderViewsList:function(e){e||(e=[]);var t=this,n=t.container.find(".viewsList");n.empty(),this.viewData=e;var r=this._getGridModel(e),i=this._getGrid(r);i.renderTo(n)},_refreshViewsList:function(){var e=this,t=e.instance.getViewService();t.loadViews("PUBLISHED",function(t,n){t?e._renderViewsList(n.views):e._showErrorMessage(e.loc.error.loadfailed)})},_getViewById:function(e){var t;for(t=0;t<this.viewData.length;++t)if(this.viewData[t].id==e)return this.viewData[t];this._showErrorMessage(this.loc.error.generic)},_confirmSetState:function(e,t){var n=this,r=Oskari.clazz.create("Oskari.userinterface.component.Popup"),i=Oskari.clazz.create("Oskari.userinterface.component.Button");i.setTitle(this.loc.button.ok),i.addClass("primary"),i.setHandler(function(){r.close(),e&&t&&e()});var s=r.createCloseButton(this.loc.button.cancel);t?r.show(n.loc.popup.showErrorTitle,n.loc.popup.showConfirmMissing,[s,i]):r.show(n.loc.popup.showErrorTitle,n.loc.popup.showConfirmNotLoaded,[s]),r.makeModal()},_confirmDelete:function(e){var t=this,n=Oskari.clazz.create("Oskari.userinterface.component.Popup"),r=Oskari.clazz.create("Oskari.userinterface.component.Button");r.setTitle(this.loc["delete"]),r.addClass("primary");var i=this.instance.sandbox;r.setHandler(function(){t._deleteView(e),n.close()});var s=n.createCloseButton(this.loc.button.cancel);n.show(t.loc.popup.deletetitle,t.loc.popup.deletemsg,[s,r]),n.makeModal()},_deleteView:function(e){var t=this,n=t.instance.getViewService();n.deleteView(e,function(e){e?t._refreshViewsList():t._showErrorMessage(t.loc.error.notdeleted)})},_showErrorMessage:function(e){var t=Oskari.clazz.create("Oskari.userinterface.component.Popup"),n=t.createCloseButton(this.loc.button.ok);n.addClass("primary"),t.show(this.loc.error.title,e,[n])},_getGridModel:function(e){var t=Oskari.clazz.create("Oskari.userinterface.component.GridModel"),n,r,i,s;t.setIdField("id");for(n=0;n<e.length;++n)r=e[n],i=r.isPublic===!0,s={id:r.id,state:r.state,name:r.name,domain:r.pubDomain,lang:r.lang,isPublic:i,show:this.loc.show,edit:this.loc.edit,publish:i?this.loc.unpublish:this.loc.publish,"delete":this.loc["delete"]},t.addData(s);return t},_getGrid:function(e){var t=this,n=this.instance,r=n.getSandbox(),i=["name","domain","publish","show","edit","delete"],s=Oskari.clazz.create("Oskari.userinterface.component.Grid");s.setDataModel(e),s.setVisibleFields(i);var o=function(e,n){var i=t.templateLink.clone();return i.append(e),i.bind("click",function(){var e=r.getLocalizedProperty(t.instance.conf.publishedMapUrl);return window.open(e+n.id,"Published","location=1,status=1,scrollbars=yes,width=850,height=800"),!1}),i};s.setColumnValueRenderer("name",o);var u=n.getViewService(),a=function(e,i,s){var o=r.getRequestBuilder("StateHandler.SetStateRequest"),a=u.isViewLayersLoaded(e,r);if(a.status||i===!0){if(o){var f=o(e.state);return f.setCurrentViewId(e.id),r.request(n,f),!0}return!1}return t._confirmSetState(s,a.msg==="missing"),!1},f=function(e,n){var r=t.templateLink.clone();return r.append(e),r.bind("click",function(){return a(n,!1,function(){return a(n,!0),!1}),!1}),r};s.setColumnValueRenderer("show",f);var l=function(e){var t=r.getRequestBuilder("Publisher.PublishMapEditorRequest");if(t){var i=t(e);r.request(n,i)}},c=function(e,n){var r=t.templateLink.clone();return r.append(e),r.bind("click",function(){return a(n,!1,function(){a(n,!0),l(n)})&&l(n),!1}),r};s.setColumnValueRenderer("edit",c);var h=function(e,n){var r=t.templateLink.clone();return r.append(e),r.bind("click",function(){var e=t._getViewById(n.id);return e&&t._confirmDelete(e),!1}),r};s.setColumnValueRenderer("delete",h),u=n.getViewService();var p=function(e,n){var r=t.templateLink.clone();return r.html(e),r.bind("click",function(){var e=t._getViewById(n.id);if(e){var i=!e.isPublic;u.makeViewPublic(n.id,i,function(s){s?(e.isPublic=i,e.isPublic?n.publish=t.loc.unpublish:n.publish=t.loc.publish,r.html(n.publish)):i?t._showErrorMessage(t.loc.error.makePublic):t._showErrorMessage(t.loc.error.makePrivate)})}return!1}),r};s.setColumnValueRenderer("publish",p);var d,v,m;for(d=0;d<i.length;++d)v=i[d],m="grid."+v,this.loc&&this.loc.grid&&this.loc.grid[v]&&(m=this.loc.grid[v]),s.setColumnUIName(v,m);return s},bindEvents:function(){var e=this.instance,t=e.getSandbox(),n;for(n in this.eventHandlers)this.eventHandlers.hasOwnProperty(n)&&t.registerForEventByName(this,n)},unbindEvents:function(){var e=this.instance,t=e.getSandbox(),n;for(n in this.eventHandlers)this.eventHandlers.hasOwnProperty(n)&&t.unregisterFromEventByName(this,n)},eventHandlers:{"Publisher.MapPublishedEvent":function(e){this._refreshViewsList()}},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(!t)return;return t.apply(this,[e])}}),define("bundles/framework/bundle/personaldata/PublishedMapsTab",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.AccountTab",function(e,t){this.conf=e.conf,this.instance=e,this.template=jQuery('<div class="account"><div class="info"></div><div class="bottomlinks"></div></div>'),this.loc=t},{getTitle:function(){return this.loc.title},addTabContent:function(e){var t=this.template.clone();e.append(t),this._createAccountTab(e)},_createAccountTab:function(e){var t=this,n=t.instance.getSandbox(),r=jQuery('<div class="dataField"><div class="label"></div><div class="value"></div><br clear="all" /></div>'),i=n.getUser(),s=this.loc,o=[{label:s.firstName,value:i.getFirstName()},{label:s.lastName,value:i.getLastName()},{label:s.nickName,value:i.getNickName()},{label:s.email,value:i.getLoginName()}],u=e.find("div.info"),a,f,l,c,h,p,d=null;for(a=0;a<o.length;a+=1)f=o[a],l=r.clone(),l.find(".label").html(f.label),l.find(".value").html(f.value),u.append(l);t.conf&&(d=n.getLocalizedProperty(t.conf.changeInfoUrl)),c=[{label:s.changeInfo,href:d}],h=e.find("div.bottomlinks");for(a=0;a<c.length;a+=1)f=c[a],f.href&&f.label&&(p=jQuery('<a href="'+f.href+'">'+f.label+"</a>&nbsp; "),h.append(p))}}),define("bundles/framework/bundle/personaldata/AccountTab",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.request.AddTabRequest",function(e,t,n){this._title=e,this._content=t,this._first=!!n},{__name:"PersonalData.AddTabRequest",getName:function(){return this.__name},getTitle:function(){return this._title},getContent:function(){return this._content},isFirst:function(){return this._first}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/personaldata/request/AddTabRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.request.AddTabRequestHandler",function(e,t){this.sandbox=e,this.personaldata=t},{handleRequest:function(e,t){this.personaldata.addTab({title:t.getTitle(),content:t.getContent(),first:t.isFirst()})}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/personaldata/request/AddTabRequestHandler",function(){}),define("normalize",["require","module"],function(e,t){function o(e,t,n){if(e.indexOf("data:")===0)return e;e=r(e);if(e.match(/^\//)||e.match(s))return e;var i=n.match(s),o=t.match(s);return o&&(!i||i[1]!=o[1]||i[2]!=o[2])?u(e,t):a(u(e,t),n)}function u(e,t){e.substr(0,2)=="./"&&(e=e.substr(2));var n=t.split("/"),r=e.split("/");n.pop();while(curPart=r.shift())curPart==".."?n.pop():n.push(curPart);return n.join("/")}function a(e,t){var n=t.split("/");n.pop(),t=n.join("/")+"/",i=0;while(t.substr(i,1)==e.substr(i,1))i++;while(t.substr(i,1)!="/")i--;t=t.substr(i+1),e=e.substr(i+1),n=t.split("/");var r=e.split("/");out="";while(n.shift())out+="../";while(curPart=r.shift())out+=curPart+"/";return out.substr(0,out.length-1)}var n=/([^:])\/+/g,r=function(e){return e.replace(n,"$1/")},s=/[^\:\/]*:\/\/([^\/])*/,f=function(e,t,n,i){t=r(t),n=r(n);var s=/@import\s*("([^"]*)"|'([^']*)')|url\s*\(\s*(\s*"([^"]*)"|'([^']*)'|[^\)]*\s*)\s*\)/ig,u,a,e;while(u=s.exec(e)){a=u[3]||u[2]||u[5]||u[6]||u[4];var f;i&&a.substr(0,1)=="/"?f=i+a:f=o(a,t,n);var l=u[5]||u[6]?1:0;e=e.substr(0,s.lastIndex-a.length-l-1)+f+e.substr(s.lastIndex-l-1),s.lastIndex=s.lastIndex+(f.length-a.length)}return e};return f.convertURIBase=o,f}),define("css",["./normalize"],function(e){function n(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}var t=0;if(typeof window=="undefined")return{load:function(e,t,n){n()}};var r=!1,i=document.getElementsByTagName("head")[0],s=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)/),o=!1;!s||(s[1]||s[7]?(o=parseInt(s[1])<6||parseInt(s[7])<=9,s="trident"):s[2]?(o=!0,s="webkit"):s[3]||(s[4]?(o=parseInt(s[4])<18,s="gecko"):r&&alert("Engine detection failed")));var u={},a=/^\/|([^\:\/]*:)/;u.pluginBuilder="./css-builder";var f=[],l={},c=[];u.addBuffer=function(e){if(n(f,e)!=-1)return;if(n(c,e)!=-1)return;f.push(e),c.push(e)},u.setBuffer=function(t,n){var r=window.location.pathname.split("/");r.pop(),r=r.join("/")+"/";var i=require.toUrl("base_url").split("/");i.pop();var s=i.join("/")+"/";s=e.convertURIBase(s,r,"/"),s.match(a)||(s="/"+s),s.substr(s.length-1,1)!="/"&&(s+="/"),u.inject(e(t,s,r));for(var o=0;o<f.length;o++)(n&&f[o].substr(f[o].length-5,5)==".less"||!n&&f[o].substr(f[o].length-4,4)==".css")&&(function(e){l[e]=l[e]||!0,setTimeout(function(){typeof l[e]=="function"&&l[e](),delete l[e]},7)}(f[o]),f.splice(o--,1))},u.attachBuffer=function(e,t){for(var r=0;r<f.length;r++)if(f[r]==e)return l[e]=t,!0;if(l[e]===!0)return l[e]=t,!0;if(n(c,e)!=-1)return t(),!0};var h=function(e,t){setTimeout(function(){for(var n=0;n<document.styleSheets.length;n++){var r=document.styleSheets[n];if(r.href==e.href)return t()}h(e,t)},10)},p=function(e,t){setTimeout(function(){try{return e.sheet.cssRules,t()}catch(n){}p(e,t)},10)};if(s=="trident"&&o)var d=[],v=[],m=0,g=function(e,t){var n;v.push({url:e,cb:t}),n=d.shift(),!n&&m++<31&&(n=document.createElement("style"),i.appendChild(n)),n&&y(n)},y=function(e){var t=v.shift();if(!t){e.onload=w,d.push(e);return}e.onload=function(){t.cb(t.ss),y(e)};try{var n=e.styleSheet;t.ss=n.imports[n.addImport(t.url)]}catch(r){alert("Got Error:"+r)}};var b=function(e){var t=document.createElement("link");return t.type="text/css",t.rel="stylesheet",t.href=e,t},w=function(){};u.linkLoad=function(e,t){var n=setTimeout(function(){r&&alert("timeout"),t()},A*1e3-100),u=function(){clearTimeout(n),a&&(a.onload=w),setTimeout(t,7)};if(!o){var a=b(e);a.onload=u,i.appendChild(a)}else if(s=="webkit"){var a=b(e);h(a,u),i.appendChild(a)}else if(s=="gecko"){var f=document.createElement("style");f.textContent='@import "'+e+'"',p(f,u),i.appendChild(f)}else s=="trident"&&g(e,u)};var E=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],S={},x=function(e,t,n){if(S[e]){t(S[e]);return}var r,i,s;if(typeof XMLHttpRequest!="undefined")r=new XMLHttpRequest;else if(typeof ActiveXObject!="undefined")for(i=0;i<3;i+=1){s=E[i];try{r=new ActiveXObject(s)}catch(o){}if(r){E=[s];break}}r.open("GET",e,requirejs.inlineRequire?!1:!0),r.onreadystatechange=function(i){var s,o;r.readyState===4&&(s=r.status,s>399&&s<600?(o=new Error(e+" HTTP status: "+s),o.xhr=r,n(o)):(S[e]=r.responseText,t(r.responseText)))},r.send(null)},T=0,N;u.inject=function(e){T<31&&(N=document.createElement("style"),N.type="text/css",i.appendChild(N),T++),N.styleSheet?N.styleSheet.cssText+=e:N.appendChild(document.createTextNode(e))};var C=/@import\s*(url)?\s*(('([^']*)'|"([^"]*)")|\(('([^']*)'|"([^"]*)"|([^\)]*))\))\s*;?/g,k=window.location.pathname.split("/");k.pop(),k=k.join("/")+"/";var L=function(t,n,r){t.match(a)||(t="/"+e.convertURIBase(t,k,"/")),x(t,function(i){i=e(i,t,k);var s=[],o=[],u=[],a;while(a=C.exec(i)){var f=a[4]||a[5]||a[7]||a[8]||a[9];s.push(f),o.push(C.lastIndex-a[0].length),u.push(a[0].length)}var l=0;for(var c=0;c<s.length;c++)(function(e){L(s[e],function(t){i=i.substr(0,o[e])+t+i.substr(o[e]+u[e]);var r=t.length-u[e];for(var a=e+1;a<s.length;a++)o[a]+=r;l++,l==s.length&&n(i)},r)})(c);s.length==0&&n(i)},r)};u.normalize=function(e,t){return e.substr(e.length-4,4)==".css"&&(e=e.substr(0,e.length-4)),t(e)};var A,O=!1;return u.load=function(e,t,n,i,s){A=A||i.waitSeconds||7;var a=e+(s?".less":".css");if(u.attachBuffer(a,n))return;var f=t.toUrl(a);!O&&r&&(alert(o?"hacking links":"not hacking"),O=!0),s?L(f,function(e){s&&(e=s(e,function(e){u.inject(e),setTimeout(n,7)}))}):u.linkLoad(f,n)},r&&(u.inspect=function(){if(stylesheet.styleSheet)return stylesheet.styleSheet.cssText;if(stylesheet.innerHTML)return stylesheet.innerHTML}),u}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/personaldata/css/personaldata.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.MyPlacesTab",function(e,t){this.instance=e,this.loc=t,this.tabsContainer=undefined,this.tabPanels={},this.linkTemplate=jQuery('<a href="JavaScript:void(0);"></a>'),this.iconTemplate=jQuery('<div class="icon"></div>')},{getName:function(){return"MyPlaces2.MyPlaces"},getTitle:function(){return this.loc.title},getTabsContainer:function(){return this.tabsContainer},getContent:function(){return this.tabsContainer.ui},initContainer:function(){this.tabsContainer=Oskari.clazz.create("Oskari.userinterface.component.TabDropdownContainer",this.loc.nocategories)},addTabContent:function(e){var t=this;this.initTabContent(),this.tabsContainer.ui.addClass("peikko"),e.append(this.tabsContainer.ui)},eventHandlers:{"MyPlaces.MyPlacesChangedEvent":function(e){var t=this.instance.sandbox.getService("Oskari.mapframework.bundle.myplaces2.service.MyPlacesService"),n=t.getAllCategories(),r=t.getAllMyPlaces(),i=this,s=function(e){return function(){var t=i.instance.sandbox.getRequestBuilder("MyPlaces.EditCategoryRequest")(e);return i.instance.sandbox.request(i.instance,t),!1}},o=function(e){return function(){var t=i.instance.sandbox.getRequestBuilder("MyPlaces.DeleteCategoryRequest")(e);return i.instance.sandbox.request(i.instance,t),!1}},u,a,f;for(u=0;u<n.length;++u){a=n[u].getId(),f=this.tabPanels[a],f?(f.setTitle(n[u].name),i.tabsContainer.updatePanel(f)):(f=this._createCategoryTab(n[u]),this.tabsContainer.addPanel(f),this.tabPanels[a]=f),this._populatePlaces(a),f.getContainer().empty(),f.grid.renderTo(f.getContainer());var l=this.linkTemplate.clone();l.addClass("categoryOp"),l.append(this.loc.editCategory),l.bind("click",s(a)),f.getContainer().append(l);var c=this.linkTemplate.clone();c.addClass("categoryOp"),c.append(this.loc.deleteCategory),c.bind("click",o(a)),f.getContainer().append(c)}this._removeObsoleteCategories()}},_showPlace:function(e,t){var n=e.getCentroid(),r=this.instance.sandbox.getRequestBuilder("MapMoveRequest")(n.x,n.y,e.getBounds(),!1);this.instance.sandbox.request(this.instance,r);var i="myplaces_"+t,s=this.instance.sandbox.findMapLayerFromSelectedMapLayers(i);if(!s){var o=this.instance.sandbox.getRequestBuilder("AddMapLayerRequest")(i,!0);this.instance.sandbox.request(this.instance,o)}},_editPlace:function(e){this._showPlace(e.geometry,e.categoryId);var t=this.instance.sandbox.getRequestBuilder("MyPlaces.EditPlaceRequest")(e.id);this.instance.sandbox.request(this.instance,t)},_deletePlace:function(e){var t=this,n=this.instance.sandbox,r=this.loc.notification["delete"],i=Oskari.clazz.create("Oskari.userinterface.component.Popup"),s=Oskari.clazz.create("Oskari.userinterface.component.Button");s.setTitle(r.btnDelete),s.addClass("primary"),s.setHandler(function(){i.close();var s=n.getService("Oskari.mapframework.bundle.myplaces2.service.MyPlacesService"),o=function(s){var o=e.categoryId,u="myplaces_"+o,a=n.findMapLayerFromSelectedMapLayers(u);if(a){var f=n.getRequestBuilder("MapModulePlugin.MapLayerUpdateRequest"),l=f(u,!0);n.request(t.instance,l)}s?i.show(r.title,r.success):i.show(r.title,r.error),i.fadeout()};s.deleteMyPlace(e.id,o)});var o=i.createCloseButton(r.btnCancel),u=r.confirm+'"'+e.name+'"'+"?";i.show(r.title,u,[o,s]),i.makeModal()},_getDrawModeFromGeometry:function(e){if(e===null)return null;var t=e.CLASS_NAME,n=null;if("OpenLayers.Geometry.MultiPoint"===t||"OpenLayers.Geometry.Point"===t)n="point";else if("OpenLayers.Geometry.MultiLineString"===t||"OpenLayers.Geometry.LineString"===t)n="line";else if("OpenLayers.Geometry.MultiPolygon"===t||"OpenLayers.Geometry.Polygon"===t)n="area";return n},_createCategoryTab:function(e){var t=this,n=e.getId(),r=Oskari.clazz.create("Oskari.userinterface.component.TabPanel");r.setId(n),r.setTitle(e.getName()),r.grid=Oskari.clazz.create("Oskari.userinterface.component.Grid");var i=["name","desc","createDate","updateDate","edit","delete"];r.grid.setVisibleFields(i);var s=function(e,n){var r=t.linkTemplate.clone(),i=t.iconTemplate.clone(),s=t._getDrawModeFromGeometry(n.geometry);return i.addClass("myplaces-"+s),r.append(i),r.append(e),r.bind("click",function(){return t._showPlace(n.geometry,n.categoryId),!1}),r};r.grid.setColumnValueRenderer("name",s);var o=function(e,n){var r=t.linkTemplate.clone();return r.append(e),r.bind("click",function(){return t._editPlace(n),!1}),r};r.grid.setColumnValueRenderer("edit",o);var u=function(e,n){var r=t.linkTemplate.clone();return r.append(e),r.bind("click",function(){return t._deletePlace(n),!1}),r};r.grid.setColumnValueRenderer("delete",u);var a,f;for(a=0;a<i.length;++a)f=i[a],r.grid.setColumnUIName(f,this.loc.grid[f]);return r},_populatePlaces:function(e){var t=this.instance.sandbox.getService("Oskari.mapframework.bundle.myplaces2.service.MyPlacesService"),n=t.getAllMyPlaces(),r=this.tabPanels[e],i=Oskari.clazz.create("Oskari.userinterface.component.GridModel");i.setIdField("id"),r.grid.setDataModel(i);var s;for(s=0;s<n.length;++s)n[s].getCategoryID()===e&&i.addData({id:n[s].getId(),name:n[s].getName(),desc:n[s].getDescription(),geometry:n[s].getGeometry(),categoryId:n[s].getCategoryID(),edit:this.loc.edit,"delete":this.loc["delete"],createDate:this._formatDate(t,n[s].getCreateDate()),updateDate:this._formatDate(t,n[s].getUpdateDate())})},_formatDate:function(e,t){var n=e.parseDate(t),r="";return n.length>0&&(r=n[0]),r},_removeObsoleteCategories:function(){var e=this.instance.sandbox.getService("Oskari.mapframework.bundle.myplaces2.service.MyPlacesService"),t,n;for(t in this.tabPanels)this.tabPanels.hasOwnProperty(t)&&(n=e.findCategory(t),n||(this.tabsContainer.removePanel(this.tabPanels[t]),this.tabPanels[t].grid=undefined,delete this.tabPanels[t].grid,this.tabPanels[t]=undefined,delete this.tabPanels[t]))},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(!t)return;return t.apply(this,[e])},bindEvents:function(){var e=this.instance,t=e.getSandbox(),n;for(n in this.eventHandlers)this.eventHandlers.hasOwnProperty(n)&&t.registerForEventByName(this,n)},unbindEvents:function(){var e=this.instance,t=e.getSandbox(),n;for(n in this.eventHandlers)this.eventHandlers.hasOwnProperty(n)&&t.unregisterFromEventByName(this,n)}}),define("bundles/framework/bundle/myplaces2/MyPlacesTab",function(){}),Oskari.registerLocalization({lang:"fi",key:"PersonalData",value:{title:"Omat tiedot",desc:"Omat tiedot",notLoggedIn:"Omiin tietoihin voit tallentaa omia karttanäkymiä ja kohteita sekä nähdä muille sivustoille julkaisemasi kartat. <a href='/web/fi/login'>Kirjaudu palveluun</a>.",tabs:{myviews:{title:"Näkymät",edit:"Muokkaa",publish:"Muuta julkiseksi",unpublish:"Muuta yksityiseksi","delete":"Poista",grid:{name:"Nimi",description:"Kuvaus",publish:"Julkaisu",edit:" ","delete":" "},popup:{edit:"Muokkaa näkymän tietoja",title:"Näkymän tallennus",label:"Näkymän nimi:",name_placeholder:"Anna näkymälle nimi",description_placeholder:"Anna näkymälle kuvaus",save:"Tallenna",cancel:"Peruuta",error_noname:"Syötä nimi",deletetitle:"Poiston varmistus",deletemsg:"Haluatko poistaa näkymän?"},save:{success:"Näkymä tallennettu.",error_noname:"Nimi ei voi olla tyhjä.",error_illegalchars:"Nimessä on luvattomia merkkejä. Sallittuja merkkejä ovat kaikki suomen kielen aakkoset, numerot sekä välilyönti ja yhdysmerkki.",msg:{view_name:"Näkymän nimi"}},button:{ok:"OK",save:"Tallenna",cancel:"Peruuta",toolbarsave:"Tallenna näkymä"},error:{title:"Virhe!",generic:"Järjestelmässä tapahtui virhe. Yritä uudelleen myöhemmin.",notsaved:"Näkymän tallentaminen epäonnistui.",notdeleted:"Näkymän poisto epäonnistui.",makePublic:"Näkymän muuttaminen julkiseksi epäonnistui. Yritä myöhemmin uudelleen.",makePrivate:"Näkymän muuttaminen yksityiseksi epäonnistui. Yritä myöhemmin uudelleen.",loadfailed:"Näkymien lataus epäonnistui."}},publishedmaps:{title:"Julkaistut kartat",show:"Näytä kartalla",edit:"Muokkaa",publish:"Julkaise kartta",unpublish:"Peru julkaisu","delete":"Poista",grid:{name:"Nimi",domain:"Kartan tiedot",publish:"Tila",show:" ",edit:" ","delete":" "},popup:{edit:"Vaihda kartan nimi",title:"Kartan tallennus",label:"Kartan nimi:",placeholder:"Anna kartalle nimi",save:"Tallenna",cancel:"Peruuta",error_noname:"Anna kartalle nimi",deletetitle:"Poiston varmistus",deletemsg:"Haluatko poistaa julkaistun kartan? Tämän jälkeen kartta ei näy sivustollasi.",showErrorTitle:"Näkymä puutteellinen",showConfirmMissing:"Osa näkymään tallennetuista tasoista ei ole käytettävissä, haluatko silti avata näkymän?",showConfirmNotLoaded:"Kaikki karttatasot eivät ole vielä latautuneet, yritä uudelleen hetken päästä."},save:{success:"Kartta tallennettu.",error_noname:"Nimi ei voi olla tyhjä.",error_illegalchars:"Nimessä on luvattomia merkkejä. Sallittuja merkkejä ovat kaikki suomen kielen aakkoset, numerot sekä välilyönti ja yhdysmerkki.",msg:{view_name:"Kartan nimi"}},button:{ok:"OK",save:"Tallenna",cancel:"Peruuta",toolbarsave:"Tallenna kartta"},error:{title:"Virhe!",generic:"Järjestelmässä tapahtui virhe. Yritä uudelleen myöhemmin.",notsaved:"Kartan tallentaminen epäonnistui.",notdeleted:"Kartan poisto epäonnistui.",makePublic:"Kartan julkaiseminen epäonnistui. Yritä myöhemmin uudelleen.",makePrivate:"Kartan vaihtaminen yksityiseksi epäonnistui. Yritä myöhemmin uudelleen."}},account:{title:"Tilin tiedot",firstName:"Etunimi",lastName:"Sukunimi",nickName:"Nimimerkki",email:"Sähköpostiosoite",changeInfo:"Muuta tietoja",changePassword:"Muuta salasana",removeAccount:"Poista tili",changeInfoUrl:"/web/fi/profiili"}},button:{yes:"Kyllä",no:"Ei"}}}),define("bundles/framework/bundle/personaldata/locale/fi",function(){}),Oskari.registerLocalization({lang:"sv",key:"PersonalData",value:{title:"Mina uppgifter",desc:"Mina uppgifter",notLoggedIn:"Du kan lagra dina egna kartvyer och titta på kartor som du har inbäddat på andra webbplatser i Mina uppgifter. <a href='/web/sv/login'>Logga in</a>.",tabs:{myviews:{title:"Mina vyer",edit:"Editera",publish:"Offentliggör",unpublish:"Gör privat","delete":"Ta bort",grid:{name:"Namn",description:"Beskrivning",publish:"Vyn är offentlig",edit:" ","delete":" "},popup:{edit:"Editera vyn",title:"Lagra vy",label:"Vyns namn",name_placeholder:"Namnge vy",description_placeholder:"Beskriv vyn",save:"Lagra",cancel:"Tillbaka",error_noname:"Skriv namnet",deletetitle:"Bekräfta radering",deletemsg:"Vill du ta bort denna vy?"},save:{success:"Vyn har lagrats.",error_noname:"Namnet kan inte vara tomt.",error_illegalchars:"I namnet ingår otillåtna tecken. Tillåtna är alla bokstäver i det svenska alfabetet, siffror, mellanslag och bindestreck.",msg:{view_name:"Vyns namn"}},button:{ok:"OK",save:"Lagra",cancel:"Tillbaka",toolbarsave:"Lagra vy"},error:{title:"Fel!",generic:"Systemfel. Försök på nytt senare.",notsaved:"Vyn kunde inte lagras.",notdeleted:"Vyn kunde inte tas bort.",makePublic:"Vyn kunde inte göras offentlig Försök på nytt senare.",makePrivate:"Vyn kunde inte göras privat. Försök på nytt senare.",loadfailed:"Vyerna kunde inte laddas ned."}},publishedmaps:{title:"Inbäddade",show:"Visa på kartan",edit:"Redigera",publish:"Avskilj karta",unpublish:"Återta avskiljandet","delete":"Ta bort",grid:{name:"Namn",domain:"Kartinställnigar",publish:"Status",show:" ",edit:" ","delete":" "},popup:{edit:"Byt namn på kartan",title:"Lagra karta",label:"Kartans namn:",placeholder:"Namnge kartan",save:"Lagra",cancel:"Tillbaka",error_noname:"Namnge kartan",deletetitle:"Vill du ta bort denna karta?",deletemsg:"Vill du ta bort den inbäddade kartan? Efter detta syns kartan inte längre på din webbplats.",showErrorTitle:"Bristfällig vy",showConfirmMissing:"En del av de kartlager som har lagrats i vyn är inte tillgängliga, vill du ändå öppna vyn?",showConfirmNotLoaded:"Alla kartlager har ännu inte laddats ned, försök på nytt om en stund."},save:{success:"Kartan har lagrats.",error_noname:"Namnet kan inte vara tomt.",error_illegalchars:"I namnet ingår otillåtna tecken. Tillåtna är alla bokstäver i det svenska alfabetet, siffror, mellanslag och bindestreck.",msg:{view_name:"Kartans namn"}},button:{ok:"OK",save:"Lagra",cancel:"Tillbaka",toolbarsave:"Lagra karta"},error:{title:"Fel!",generic:"Systemfel. Försök på nytt senare.",notsaved:"Kartan kunde inte lagras.",notdeleted:"Kartan kunde inte tas bort.",makePublic:"Kartan kunde inte göras offentlig. Försök på nytt senare.",makePrivate:"Kartan kunde inte göras privat. Försök på nytt senare."}},account:{title:"Användarkonto",firstName:"Förnamn",lastName:"Efternamn",nickName:"Signatur",email:"E-postadress",changeInfo:"Ändra uppgifter",changePassword:"Byt ut lösenordet",removeAccount:"Radera konto",changeInfoUrl:"/web/sv/profil"}},button:{yes:"Ja",no:"Nej"}}}),define("bundles/framework/bundle/personaldata/locale/sv",function(){}),Oskari.registerLocalization({lang:"en",key:"PersonalData",value:{title:"My data",desc:"My data",notLoggedIn:"You can save map views and browse maps that you have embedded on other websites in My data. <a href='/web/en/login'>Log in</a>.",tabs:{myviews:{title:"My map views",edit:"Edit",publish:"Publish",unpublish:"Unpublish","delete":"Delete",grid:{name:"Name",description:"Description",publish:"Published",edit:" ","delete":" "},popup:{edit:"Edit view's information",title:"Save map view",label:"Name of map view:",name_placeholder:"Give the map view a name",description_placeholder:"Give the map view a description",save:"Save",cancel:"Cancel",error_noname:"Type the name",deletetitle:"Confirm delete",deletemsg:"Do you want to delete this map view?"},save:{success:"The map view has been saved.",error_noname:"The name field cannot be blank.",error_illegalchars:"The name contains disallowed characters. Allowed characters are the letters a-z as well as å, ä and ö, numbers, backspaces and hyphens.",msg:{view_name:"The name of the map view"}},button:{ok:"OK",save:"Save",cancel:"Cancel",toolbarsave:"Save map view"},error:{title:"Error!",generic:"System error. Please try again later.",notsaved:"The map view could not be saved.",notdeleted:"The map view could not be deleted.",makePublic:"The map view could not be published. Please try again later.",makePrivate:"The map view could not be unpublished. Please try again later.",loadfailed:"The map views could not be downloaded."}},publishedmaps:{title:"Embedded maps",show:"Show on the map",edit:"Edit",publish:"Publish map",unpublish:"Unpublish map","delete":"Delete",grid:{name:"Name",domain:"Map settings",publish:"Status",show:" ",edit:" ","delete":" "},popup:{edit:"Change map name",title:"Save map",label:"Map name",placeholder:"Give the map a name",save:"Save",cancel:"Cancel",error_noname:"Give the map a name",deletetitle:"Delete map?",deletemsg:"Do you want to delete the embedded map? It will no longer be shown on your website.",showErrorTitle:"Incomplete view",showConfirmMissing:"Some saved map layers are not available, do you still want to open this view?",showConfirmNotLoaded:"Some map layers have not yet loaded, try again later."},save:{success:"The map has been saved.",error_noname:"The name field cannot be blank.",error_illegalchars:"The name contains disallowed characters. Allowed characters are the letters a-z as well as å, ä and ö, numbers, backspaces and hyphens.",msg:{view_name:"Map name"}},button:{ok:"OK",save:"Save",cancel:"Cancel",toolbarsave:"Save map"},error:{title:"Error!",generic:"System error. Please try again later.",notsaved:"The map could not be saved.",notdeleted:"The map could not be deleted.",makePublic:"The map could not be published. Please try again later.",makePrivate:"The map could not be unpublished. Please try again later."}},account:{title:"My account",firstName:"First name",lastName:"Last name",nickName:"Nickname",email:"E-mail",changeInfo:"Change your account information",changePassword:"Change your password",removeAccount:"Delete your account",changeInfoUrl:"/web/en/profile"}},button:{yes:"Yes",no:"No"}}}),define("bundles/framework/bundle/personaldata/locale/en",function(){}),Oskari.registerLocalization({lang:"cs",key:"PersonalData",value:{title:"Moje data",desc:"Moje data",notLoggedIn:"Lze uložit zobrazení map a prohlížet mapy, které jste vložili do jiných webů v Mých datech. <a href='/web/en/login'>Přihlásit se</a>.",tabs:{myviews:{title:"Má zobrazení mapy",edit:"Upravit",publish:"Publikovat",unpublish:"Zrušit publikaci","delete":"Smazat",grid:{name:"Jméno",description:"Popis",publish:"Publikováno",edit:" ","delete":" "},popup:{edit:"Upravit informace o zobrazení",title:"Uložit zobrazení mapy",label:"Jméno zobrazení mapy:",name_placeholder:"Pojmenujte zobrazení mapy",description_placeholder:"Popište zobrazení mapy",save:"Uložit",cancel:"Storno",error_noname:"Zadejte jméno",deletetitle:"Potvrďte smazání",deletemsg:"Chcete toto zobrazení mapy smazat?"},save:{success:"Zobrazení mapy bylo smazáno.",error_noname:"Pole jména nemůže být prázdné.",error_illegalchars:"Jméno obsahuje nepovolené znaky. Povolené znaky jsou a-z, å, ä a ö, čísla, mezery a pomlčky.",msg:{view_name:"Jméno zobrazení mapy"}},button:{ok:"OK",save:"Uložit",cancel:"Storno",toolbarsave:"Uložit zobrazení mapy"},error:{title:"Chyba!",generic:"Systémová chyba. Zkuste to prosím později.",notsaved:"Zobrazení mapy nemohlo být uloženo.",notdeleted:"Zobrazení mapy nemohlo být smazáno.",makePublic:"Zobrazení mapy nemohlo být publikováno. Zkuste to prosím později.",makePrivate:"Zobrazení mapy nemohla být zrušena publikace. Zkuste to prosím později.",loadfailed:"Zobrazení mapy nemohlo být staženo."}},publishedmaps:{title:"Vložené mapy",show:"Ukaž na mapě",edit:"Upravit",publish:"Publikovat mapu",unpublish:"Zrušit publikaci mapy","delete":"Smazat",grid:{name:"Jméno",domain:"Nastavení mapy",publish:"Stav",show:" ",edit:" ","delete":" "},popup:{edit:"Změnit jméno mapy",title:"Uložit mapu",label:"Jméno mapy",placeholder:"Pojmenovat mapu",save:"Uložit",cancel:"Storno",error_noname:"Pojmenovat mapu",deletetitle:"Smazat mapu?",deletemsg:"Chcete vloženou mapu smazat? Pak již nebude zobrazována na vašem webu.",showErrorTitle:"Neúplné zobrazení",showConfirmMissing:"Některé uložené mapové vrstvy nejsou dostupné, chcete stále otevřít tuto novou?",showConfirmNotLoaded:"Některé mapové vrstvy nebyly nahrány, zkuste to později."},save:{success:"Mapa byla uložena.",error_noname:"Pole jména nemůže být prázdné.",error_illegalchars:"Jméno obsahuje nepovolené znaky. Povolené znaky jsou a-z, å, ä a ö, čísla, mezery a pomlčky.",msg:{view_name:"Jméno mapy"}},button:{ok:"OK",save:"Uložit",cancel:"Storno",toolbarsave:"Uložit mapu"},error:{title:"Chyba!",generic:"Systémová chyba. Zkuste to prosím později.",notsaved:"Mapa nemohla být uložena.",notdeleted:"Mapa nemohla být smazána.",makePublic:"Mapa nemohla být publikována. Zkuste to prosím později.",makePrivate:"Mapě nemohla být zrušena publikace. Zkuste to prosím později."}},account:{title:"Můj účet",firstName:"Křestní jméno",lastName:"Příjmení",nickName:"Přezdívka",email:"E-mail",changeInfo:"Změnit informace o vašem účtu",changePassword:"Změnit vaše heslo",removeAccount:"Zrušit váš účet",changeInfoUrl:"/web/en/profile"}},button:{yes:"Ano",no:"Ne"}}}),define("bundles/framework/bundle/personaldata/locale/cs",function(){}),Oskari.registerLocalization({lang:"de",key:"PersonalData",value:{title:"Meine Daten",desc:"Meine Daten",notLoggedIn:"Sie können unter \"Meine Daten\" Kartenansichten speichern und Karten durchsuchen, die Sie auf anderen Webseiten eingebunden haben. <a href='/web/en/login'>Anmelden</a>.",tabs:{myviews:{title:"Meine Kartenansichten",edit:"Bearbeiten",publish:"Veröffentlichen",unpublish:"Veröffentlichung rückgängig machen","delete":"Löschen",grid:{name:"Name",description:"Beschreibung",publish:"Veröffentlicht",edit:" ","delete":" "},popup:{edit:"Informationen zur Kartenansicht bearbeiten",title:"Kartenansicht speichern",label:"Name der Kartenansicht:",name_placeholder:"Geben Sie der Kartenansicht einen Namen",description_placeholder:"Beschreiben Sie die Kartenansicht",save:"Speichern",cancel:"Abbrechen",error_noname:"Geben Sie den Namen ein",deletetitle:"Löschen bestätigen",deletemsg:"Möchten Sie diese Kartenansicht löschen?"},save:{success:"Diese Kartenansicht wurde gespeichert.",error_noname:"Das Namensfeld darf nicht leer sein.",error_illegalchars:"Der Name enthält unzulässige Zeichen. Erlaubte Zeichen sind die Buchstaben a-z, å, ä, ö sowie Zahlen, Bindestriche und die Backspace-Taste.",msg:{view_name:"Der Name der Kartenansicht"}},button:{ok:"OK",save:"Speichern",cancel:"Abbrechen",toolbarsave:"Kartenansicht speichern"},error:{title:"Fehler!",generic:"Systemfehler! Bitte versuchen Sie es später noch einmal",notsaved:"Die Kartenansicht konnte nicht gespeichert werden.",notdeleted:"Die Kartenansicht konnte nicht gelöscht werden.",makePublic:"Die Kartenansicht konnte nicht veröffentlicht werden. Bitte versuchen Sie es später noch einmal.",makePrivate:"Die Veröffentlichung der Kartenansicht konnte nicht rückgängig gemacht werden. Bitte versuchen Sie es später noch einmal.",loadfailed:"Die Kartenansichten konnte nicht heruntergeladen werden."}},publishedmaps:{title:"Eingebundene Karten",show:"Auf der Karte anzeigen",edit:"Bearbeiten",publish:"Karte veröffentlichen",unpublish:"Veröffentlichung der Karte rückgängig machen","delete":"Löschen",grid:{name:"Name",domain:"Karteneinstellungen",publish:"Status",show:" ",edit:" ","delete":" "},popup:{edit:"Kartenname ändern",title:"Karte speichern",label:"Kartenname",placeholder:"Geben Sie der Karte einen Namen",save:"Speichern",cancel:"Abbrechen",error_noname:"Geben Sie der Karte einen Namen",deletetitle:"Karte löschen?",deletemsg:"Möchten Sie die eingebundene Karte löschen? Sie wird nicht länger auf Ihrer Webseite angezeigt.",showErrorTitle:"Unvollständige Ansicht",showConfirmMissing:"Einige der gespeicherten Kartenebenen sind nicht verfügbar. Möchten Sie die Ansicht trotzdem öffnen?",showConfirmNotLoaded:"Einige Kartenebenen sind noch nicht geladen, bitte versuchen Sie es später noch einmal."},save:{success:"Die Karte wurde gespeichert.",error_noname:"Das Namensfeld darf nicht leer sein.",error_illegalchars:"Der Name enthält unzulässige Zeichen. Erlaubte Zeichen sind die Buchstaben a-z, å, ä, ö sowie Zahlen, Bindestriche und die Backspace-Taste.",msg:{view_name:"Kartenname"}},button:{ok:"OK",save:"Speichern",cancel:"Abbrechen",toolbarsave:"Karte speichern"},error:{title:"Fehler!",generic:"Systemfehler! Bitte versuchen Sie es später noch einmal.",notsaved:"Die Karte konnte nicht gespeichert werden.",notdeleted:"Die Karte konnte nicht gelöscht werden.",makePublic:"Die Karte konnte nicht veröffentlicht werden. Bitte versuchen Sie es später noch einmal.",makePrivate:"Die Veröffentlichung der Karte konnte nicht rückgängig gemacht werden. Bitte versuchen Sie es später noch einmal."}},account:{title:"Mein Konto",firstName:"Vorname",lastName:"Nachname",nickName:"Spitzname",email:"E-Mail",changeInfo:"Ändern Sie Ihre Konto-Informationen",changePassword:"Ändern Sie Ihr Passwort",removeAccount:"Löschen Sie Ihr Konto",changeInfoUrl:"/web/en/profile"}},button:{yes:"Ja",no:"Nein"}}}),define("bundles/framework/bundle/personaldata/locale/de",function(){}),Oskari.registerLocalization({lang:"es",key:"PersonalData",value:{title:"Mis datos",desc:"Mis datos",notLoggedIn:"En Mis datos, puede guardar vistas y navegar por los mapas que haya incorporado en otros portales web. <a href='/web/en/login'>Acceder</a>.",tabs:{myviews:{title:"Mis vistas",edit:"Editar",publish:"Publicar",unpublish:"Despublicar","delete":"Borrar",grid:{name:"Nombre",description:"Descripción",publish:"Publicado",edit:" ","delete":" "},popup:{edit:"Editar información de la vista",title:"Guardar vista",label:"Nombre de la vista:",name_placeholder:"Asignar un nombre a la vista",description_placeholder:"Asignar una descripción a la vista",save:"Guardar",cancel:"Cancelar",error_noname:"Tipo de nombre",deletetitle:"Confirmar borrado",deletemsg:"¿Desea borrar esta vista?"},save:{success:"Se ha guardado la vista.",error_noname:"El nombre del campo no puede estar vacío.",error_illegalchars:"El nombre contiene caracteres no permitidos. Los caracteres permitidos son las letras entre a-z, los números, los espacios y los guiones.",msg:{view_name:"El nombre de la vista"}},button:{ok:"Hecho",save:"Guardar",cancel:"Cancelar",toolbarsave:"Guardar vista"},error:{title:"¡Error!",generic:"¡Error del sistema! Por favor, inténtelo más tarde",notsaved:"No pudo guardarse la vista.",notdeleted:"No pudo borrarse la vista.",makePublic:"No pudo publicarse la vista. Por favor, inténtelo más tarde.",makePrivate:"No pudo despublicarse la vista. Por favor, inténtelo más tarde.",loadfailed:"No pudieron descargarse las vistas."}},publishedmaps:{title:"Mapas incorporados",show:"Mostrar en el mapa",edit:"Editar",publish:"Publicar mapa",unpublish:"Despublicar mapa","delete":"Borrar",grid:{name:"Nombre",domain:"Configuración del mapa",publish:"Estado",show:" ",edit:" ","delete":" "},popup:{edit:"Cambiar el nombre del mapa",title:"Guardar mapa",label:"Nombre del mapa",placeholder:"Asignar un nombre al mapa",save:"Guardar",cancel:"Cancelar",error_noname:"Asignar un nombre al mapa",deletetitle:"¿Borrar el mapa?",deletemsg:"¿Desea borrar el mapa incorporado? No se mostrará más en tu portal web.",showErrorTitle:"Vista incompleta",showConfirmMissing:"Algunas capas guardadas no están disponibles. Aun así, ¿quiere abrir esta vista?",showConfirmNotLoaded:"Algunas capas no se han cargado todavía, inténtelo más tarde."},save:{success:"Se ha guardado el mapa.",error_noname:"El nombre del campo no puede estar vacío.",error_illegalchars:"El nombre contiene caracteres no permitidos. Los caracteres permitidos son las letras entre a-z, los números, los espacios y los guiones.",msg:{view_name:"Nombre del mapa"}},button:{ok:"Hecho",save:"Guardar",cancel:"Cancelar",toolbarsave:"Guardar mapa"},error:{title:"¡Error!",generic:"¡Error del sistema! Por favor, inténtelo más tarde.",notsaved:"No pudo guardarse el mapa.",notdeleted:"No pudo borrarse el mapa.",makePublic:"No pudo publicarse el mapa. Por favor, inténtelo más tarde.",makePrivate:"No pudo despublicarse el mapa. Por favor, inténtelo más tarde."}},account:{title:"Mi cuenta",firstName:"Nombre",lastName:"Apellido",nickName:"Alias",email:"Correo electrónico",changeInfo:"Cambiar la información de su cuenta",changePassword:"Cambiar su contraseña",removeAccount:"Borrar su cuenta",changeInfoUrl:"/web/en/profile"}},button:{yes:"Si",no:"No"}}}),define("bundles/framework/bundle/personaldata/locale/es",function(){}),define("src/framework/personaldata/module",["oskari","jquery","bundles/framework/bundle/personaldata/instance","bundles/framework/bundle/personaldata/Flyout","bundles/framework/bundle/personaldata/Tile","bundles/framework/bundle/personaldata/MyViewsTab","bundles/framework/bundle/personaldata/service/ViewService","bundles/framework/bundle/personaldata/PublishedMapsTab","bundles/framework/bundle/personaldata/AccountTab","bundles/framework/bundle/personaldata/request/AddTabRequest","bundles/framework/bundle/personaldata/request/AddTabRequestHandler","css!resources/framework/bundle/personaldata/css/personaldata.css","bundles/framework/bundle/myplaces2/MyPlacesTab","bundles/framework/bundle/personaldata/locale/fi","bundles/framework/bundle/personaldata/locale/sv","bundles/framework/bundle/personaldata/locale/en","bundles/framework/bundle/personaldata/locale/cs","bundles/framework/bundle/personaldata/locale/de","bundles/framework/bundle/personaldata/locale/es"],function(e,t){return e.bundleCls("personaldata").category({create:function(){var t=this,n=e.clazz.create("Oskari.mapframework.bundle.personaldata.PersonalDataBundleInstance");return n},update:function(e,t,n,r){}})}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.setBuffer("/* account tab */\ndiv.tab-content div.account div.dataField {\n  padding: 10px; }\n\ndiv.tab-content div.account div.dataField div.label {\n  float: left;\n  width: 40%; }\n\n/* My Views tab*/\ndiv.view {\n  padding: 5px; }\n\ndiv.view.odd {\n  background-color: #f3f3f3; }\n\ndiv.view div.name {\n  display: inline-block; }\n\ndiv.view div.tools {\n  float: right; }\n\ndiv.view div.tools div {\n  display: inline-block;\n  margin-right: 5px; }\n\ndiv.personaldata td div.icon {\n  display: inline-block;\n  vertical-align: top; }\n\ndiv.personaldata a.categoryOp {\n  margin: 5px; }\n\ndiv.personaldata a.categoryOp div.icon {\n  display: inline-block; }\n\ntextarea#view_description {\n  resize: none;\n  width: 100%; }\n")}),requirejs.s.contexts._.nextTick=requirejs.nextTick;
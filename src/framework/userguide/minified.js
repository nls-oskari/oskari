Oskari.clazz.define("Oskari.mapframework.bundle.userguide.UserGuideBundleInstance",function(){this.sandbox=null,this.started=!1,this.plugins={},this.localization=null,this.ui=null,this._requestHandlers={},this.attachedToDefault=!1,this.helper=null,this.isContentLoaded=!1},{templates:{userguide:'<div class="oskari-userguide"><span class="oskari-prompt"></span><br /></div>'},__name:"userinterface.UserGuide",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},getLocalization:function(e){return e?this._localization[e]:this._localization},start:function(){var e=this;if(e.started)return;e.started=!0;var t=this.conf,n=(t?t.sandbox:null)||"sandbox",r=Oskari.getSandbox(n);e.sandbox=r,this._localization=Oskari.getLocalization(this.getName());var i=this.getLocalization("title"),s=Oskari.clazz.create("Oskari.userinterface.component.Popover",i,""),o;this.ui=s,s.setContent($(this.templates.userguide)),r.register(e);for(o in e.eventHandlers)e.eventHandlers.hasOwnProperty(o)&&r.registerForEventByName(e,o);this._requestHandlers["userguide.ShowUserGuideRequest"]=Oskari.clazz.create("Oskari.mapframework.bundle.userguide.request.ShowUserGuideRequestHandler",r,this),r.addRequestHandler("userguide.ShowUserGuideRequest",this._requestHandlers["userguide.ShowUserGuideRequest"]);var u=r.getRequestBuilder("userinterface.AddExtensionRequest")(this);r.request(this,u),e.createUi();var a=Oskari.clazz.create("Oskari.userinterface.component.UIHelper",r);this.helper=a},init:function(){return null},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(!t)return;return t.apply(this,[e])},eventHandlers:{"userinterface.ExtensionUpdatedEvent":function(e){var t=this;if(e.getExtension().getName()!==t.getName())return;var n=e.getViewState()!=="close";t.displayContent(n)}},displayContent:function(e){var t=this;if(!e)return;if(t.isContentLoaded)return;var n="help.contentPart";t.getLocalization("help")&&t.getLocalization("help").contentPart&&(n=t.getLocalization("help").contentPart);var r="help.tags";this.getLocalization("help")&&this.getLocalization("help").tags&&(r=this.getLocalization("help").tags),this.helper.getHelpArticle(r,function(e,r){var i=r,s="error.generic";t.getLocalization("error")&&t.getLocalization("error").generic&&(s=t.getLocalization("error").generic),e?i[n]&&(i=i[n]):i=s,t.plugins["Oskari.userinterface.Flyout"].setContent(i),t.isContentLoaded=!0})},toggleUserInterface:function(e,t){var n=this,r=this.ui;if(!e)r.hide();else{if(!n.attachedToDefault){var i=n.plugins["Oskari.userinterface.Tile"].getEl();r.setPlacement("right"),r.attachTo(i),n.attachedToDefault=!0}r.show()}},scheduleShowUserGuide:function(e){var t=this,n=t.ui,r=e.isToggle();if(r&&n.shown){t.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[this,"close"]);return}t.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[this,"attach"]);var i=jQuery(this.templates.userguide),s=jQuery("<div />"),o=Oskari.getLang(),u=s.clone(),a=e.getContent();a?i.append(a):(u.append("Lang: "+o),i.append(u),u=s.clone(),u.append("Extension: "+e.getExtension()),i.append(u),u=s.clone(),u.append("Context: "+e.getContext()),i.append(u),u=s.clone(),u.append("Element: "+(e.getEl()?"YES":"NO")),i.append(u));var f=e.getEl(),l=e.getPlacement();l&&n.setPlacement(l),f?(n.hide(),t.attachedToDefault=!1,n.attachTo(f)):t.attachedToDefault||(f=t.plugins["Oskari.userinterface.Tile"].getEl(),n.attachTo(f),t.attachedToDefault=!0),n.setContent(i)},stop:function(){var e=this.sandbox(),t;for(t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&e.unregisterFromEventByName(this,t);e.removeRequestHandler("userguide.ShowUserGuideRequest",this._requestHandlers["userguide.ShowUserGuideRequest"]);var n=e.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);e.request(this,n),this.sandbox.unregister(this),this.started=!1},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.userguide.Flyout",this),this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.mapframework.bundle.userguide.Tile",this,this.getLocalization("tile"))},stopExtension:function(){this.plugins["Oskari.userinterface.Tile"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},createUi:function(){var e=this;this.plugins["Oskari.userinterface.Tile"].refresh(),this.plugins["Oskari.userinterface.Flyout"].setContent("")}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]}),define("bundles/framework/bundle/userguide/instance",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.userguide.request.ShowUserGuideRequest",function(e){var t=e||{};this._creator=null,this._el=t.el,this._context=t.context,this._extension=t.extension,this._toggle=t.toggle,this._placement=t.placement,this._content=t.content},{__name:"userguide.ShowUserGuideRequest",getName:function(){return this.__name},getUuid:function(){return this._uuid},getContext:function(){return this._context},getExtension:function(){return this._extension},getEl:function(){return this._el},isToggle:function(){return this._toggle},getPlacement:function(){return this._placement},getContent:function(){return this._content}},{protocol:["Oskari.mapframework.request.Request"]}),define("bundles/framework/bundle/userguide/request/ShowUserGuideRequest",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.userguide.request.ShowUserGuideRequestHandler",function(e,t){this.sandbox=e,this.instance=t},{handleRequest:function(e,t){this.sandbox.printDebug("[Oskari.mapframework.bundle.userguide.request.ShowUserGuideRequestHandler] Show UserGuide: "+t.getUuid()),this.instance.scheduleShowUserGuide(t)}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),define("bundles/framework/bundle/userguide/request/ShowUserGuideRequestHandler",function(){}),define("bundles/framework/bundle/userguide/service/UserGuideService",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.userguide.Tile",function(e,t){this.instance=e,this.locale=t,this.container=null,this.template=null},{getName:function(){return"Oskari.mapframework.bundle.userguide.Tile"},setEl:function(e,t,n){this.container=jQuery(e);var r=this.container.children(".oskari-tile-status")},getEl:function(){return this.container},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.locale.title},getDescription:function(){return this.locale.desciption},getOptions:function(){},refresh:function(){var e=this,t=e.instance,n=this.container,r=this.template,i=t.getSandbox()}},{protocol:["Oskari.userinterface.Tile"]}),define("bundles/framework/bundle/userguide/Tile",function(){}),Oskari.clazz.define("Oskari.mapframework.bundle.userguide.Flyout",function(e){this.instance=e,this.container=null,this.state=null,this.template=null},{getName:function(){return"Oskari.mapframework.bundle.userguide.Flyout"},setEl:function(e,t,n){this.container=e[0],jQuery(this.container).hasClass("userguide")||jQuery(this.container).addClass("userguide")},startPlugin:function(){this.template=jQuery('<div class="userguide"></div>')},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(e){this.state=e},getState:function(){return this.state?this.state:{}},setContent:function(e){var t=this,n=t.instance.getSandbox(),r=jQuery(this.container);r.empty();var i=this.template.clone();i.append(e),r.append(i)}},{protocol:["Oskari.userinterface.Flyout"]}),define("bundles/framework/bundle/userguide/Flyout",function(){}),define("normalize",["require","module"],function(e,t){function o(e,t,n){if(e.indexOf("data:")===0)return e;e=r(e);if(e.match(/^\//)||e.match(s))return e;var i=n.match(s),o=t.match(s);return o&&(!i||i[1]!=o[1]||i[2]!=o[2])?u(e,t):a(u(e,t),n)}function u(e,t){e.substr(0,2)=="./"&&(e=e.substr(2));var n=t.split("/"),r=e.split("/");n.pop();while(curPart=r.shift())curPart==".."?n.pop():n.push(curPart);return n.join("/")}function a(e,t){var n=t.split("/");n.pop(),t=n.join("/")+"/",i=0;while(t.substr(i,1)==e.substr(i,1))i++;while(t.substr(i,1)!="/")i--;t=t.substr(i+1),e=e.substr(i+1),n=t.split("/");var r=e.split("/");out="";while(n.shift())out+="../";while(curPart=r.shift())out+=curPart+"/";return out.substr(0,out.length-1)}var n=/([^:])\/+/g,r=function(e){return e.replace(n,"$1/")},s=/[^\:\/]*:\/\/([^\/])*/,f=function(e,t,n,i){t=r(t),n=r(n);var s=/@import\s*("([^"]*)"|'([^']*)')|url\s*\(\s*(\s*"([^"]*)"|'([^']*)'|[^\)]*\s*)\s*\)/ig,u,a,e;while(u=s.exec(e)){a=u[3]||u[2]||u[5]||u[6]||u[4];var f;i&&a.substr(0,1)=="/"?f=i+a:f=o(a,t,n);var l=u[5]||u[6]?1:0;e=e.substr(0,s.lastIndex-a.length-l-1)+f+e.substr(s.lastIndex-l-1),s.lastIndex=s.lastIndex+(f.length-a.length)}return e};return f.convertURIBase=o,f}),define("css",["./normalize"],function(e){function n(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}var t=0;if(typeof window=="undefined")return{load:function(e,t,n){n()}};var r=!1,i=document.getElementsByTagName("head")[0],s=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)/),o=!1;!s||(s[1]||s[7]?(o=parseInt(s[1])<6||parseInt(s[7])<=9,s="trident"):s[2]?(o=!0,s="webkit"):s[3]||(s[4]?(o=parseInt(s[4])<18,s="gecko"):r&&alert("Engine detection failed")));var u={},a=/^\/|([^\:\/]*:)/;u.pluginBuilder="./css-builder";var f=[],l={},c=[];u.addBuffer=function(e){if(n(f,e)!=-1)return;if(n(c,e)!=-1)return;f.push(e),c.push(e)},u.setBuffer=function(t,n){var r=window.location.pathname.split("/");r.pop(),r=r.join("/")+"/";var i=require.toUrl("base_url").split("/");i.pop();var s=i.join("/")+"/";s=e.convertURIBase(s,r,"/"),s.match(a)||(s="/"+s),s.substr(s.length-1,1)!="/"&&(s+="/"),u.inject(e(t,s,r));for(var o=0;o<f.length;o++)(n&&f[o].substr(f[o].length-5,5)==".less"||!n&&f[o].substr(f[o].length-4,4)==".css")&&(function(e){l[e]=l[e]||!0,setTimeout(function(){typeof l[e]=="function"&&l[e](),delete l[e]},7)}(f[o]),f.splice(o--,1))},u.attachBuffer=function(e,t){for(var r=0;r<f.length;r++)if(f[r]==e)return l[e]=t,!0;if(l[e]===!0)return l[e]=t,!0;if(n(c,e)!=-1)return t(),!0};var h=function(e,t){setTimeout(function(){for(var n=0;n<document.styleSheets.length;n++){var r=document.styleSheets[n];if(r.href==e.href)return t()}h(e,t)},10)},p=function(e,t){setTimeout(function(){try{return e.sheet.cssRules,t()}catch(n){}p(e,t)},10)};if(s=="trident"&&o)var d=[],v=[],m=0,g=function(e,t){var n;v.push({url:e,cb:t}),n=d.shift(),!n&&m++<31&&(n=document.createElement("style"),i.appendChild(n)),n&&y(n)},y=function(e){var t=v.shift();if(!t){e.onload=w,d.push(e);return}e.onload=function(){t.cb(t.ss),y(e)};try{var n=e.styleSheet;t.ss=n.imports[n.addImport(t.url)]}catch(r){alert("Got Error:"+r)}};var b=function(e){var t=document.createElement("link");return t.type="text/css",t.rel="stylesheet",t.href=e,t},w=function(){};u.linkLoad=function(e,t){var n=setTimeout(function(){r&&alert("timeout"),t()},A*1e3-100),u=function(){clearTimeout(n),a&&(a.onload=w),setTimeout(t,7)};if(!o){var a=b(e);a.onload=u,i.appendChild(a)}else if(s=="webkit"){var a=b(e);h(a,u),i.appendChild(a)}else if(s=="gecko"){var f=document.createElement("style");f.textContent='@import "'+e+'"',p(f,u),i.appendChild(f)}else s=="trident"&&g(e,u)};var E=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],S={},x=function(e,t,n){if(S[e]){t(S[e]);return}var r,i,s;if(typeof XMLHttpRequest!="undefined")r=new XMLHttpRequest;else if(typeof ActiveXObject!="undefined")for(i=0;i<3;i+=1){s=E[i];try{r=new ActiveXObject(s)}catch(o){}if(r){E=[s];break}}r.open("GET",e,requirejs.inlineRequire?!1:!0),r.onreadystatechange=function(i){var s,o;r.readyState===4&&(s=r.status,s>399&&s<600?(o=new Error(e+" HTTP status: "+s),o.xhr=r,n(o)):(S[e]=r.responseText,t(r.responseText)))},r.send(null)},T=0,N;u.inject=function(e){T<31&&(N=document.createElement("style"),N.type="text/css",i.appendChild(N),T++),N.styleSheet?N.styleSheet.cssText+=e:N.appendChild(document.createTextNode(e))};var C=/@import\s*(url)?\s*(('([^']*)'|"([^"]*)")|\(('([^']*)'|"([^"]*)"|([^\)]*))\))\s*;?/g,k=window.location.pathname.split("/");k.pop(),k=k.join("/")+"/";var L=function(t,n,r){t.match(a)||(t="/"+e.convertURIBase(t,k,"/")),x(t,function(i){i=e(i,t,k);var s=[],o=[],u=[],a;while(a=C.exec(i)){var f=a[4]||a[5]||a[7]||a[8]||a[9];s.push(f),o.push(C.lastIndex-a[0].length),u.push(a[0].length)}var l=0;for(var c=0;c<s.length;c++)(function(e){L(s[e],function(t){i=i.substr(0,o[e])+t+i.substr(o[e]+u[e]);var r=t.length-u[e];for(var a=e+1;a<s.length;a++)o[a]+=r;l++,l==s.length&&n(i)},r)})(c);s.length==0&&n(i)},r)};u.normalize=function(e,t){return e.substr(e.length-4,4)==".css"&&(e=e.substr(0,e.length-4)),t(e)};var A,O=!1;return u.load=function(e,t,n,i,s){A=A||i.waitSeconds||7;var a=e+(s?".less":".css");if(u.attachBuffer(a,n))return;var f=t.toUrl(a);!O&&r&&(alert(o?"hacking links":"not hacking"),O=!0),s?L(f,function(e){s&&(e=s(e,function(e){u.inject(e),setTimeout(n,7)}))}):u.linkLoad(f,n)},r&&(u.inspect=function(){if(stylesheet.styleSheet)return stylesheet.styleSheet.cssText;if(stylesheet.innerHTML)return stylesheet.innerHTML}),u}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.addBuffer("resources/framework/bundle/userguide/css/style.css")}),requirejs.s.contexts._.nextTick=requirejs.nextTick,Oskari.registerLocalization({lang:"fi",key:"userinterface.UserGuide",value:{title:"Ohje",desc:"",flyout:{title:"Kartan ohje"},tile:{title:"Kartan ohje"},error:{title:"Virhe!",generic:"Ohjeen lataaminen epäonnistui. Yritä myöhemmin uudelleen."},help:{tags:"karttaikkuna,pikaohje",contentPart:"body"}}}),define("bundles/framework/bundle/userguide/locale/fi",function(){}),Oskari.registerLocalization({lang:"sv",key:"userinterface.UserGuide",value:{title:"Hjälp",desc:"",flyout:{title:"Så här använder du Paikkatietoikkuna"},tile:{title:"Bruksanvisningar"},error:{title:"Fel!",generic:"Laddningen av anvisningarna misslyckades. Försök på nytt senare."},help:{tags:"kartfönstret,snappguide",contentPart:"body"}}}),define("bundles/framework/bundle/userguide/locale/sv",function(){}),Oskari.registerLocalization({lang:"en",key:"userinterface.UserGuide",value:{title:"Help",desc:"",flyout:{title:"Paikkatietoikkuna user guide"},tile:{title:"Map user guide"},error:{title:"Error!",generic:"Loading user guide failed. Please try again later."},help:{tags:"map window,user guide",contentPart:"body"}}}),define("bundles/framework/bundle/userguide/locale/en",function(){}),Oskari.registerLocalization({lang:"cs",key:"userinterface.UserGuide",value:{title:"Nápověda",desc:"",flyout:{title:"Uživatelská příručka Paikkatietoikkuna"},tile:{title:"Uživatelská příručka mapy"},error:{title:"Chyba!",generic:"Nahrávání uživatelské příručky selhalo. Zkuste to prosím později."},help:{tags:"map window,user guide",contentPart:"body"}}}),define("bundles/framework/bundle/userguide/locale/cs",function(){}),Oskari.registerLocalization({lang:"de",key:"userinterface.UserGuide",value:{title:"Hilfe",desc:"",flyout:{title:"Paikkatietoikkuna Benutzerhandbuch"},tile:{title:"Kartennutzerhandbuch"},error:{title:"Fehler!",generic:"Fehler beim Laden des Benutzerhandbuchs. Bitte versuchen Sie es später noch einmal."},help:{tags:"map window,user guide",contentPart:"body"}}}),define("bundles/framework/bundle/userguide/locale/de",function(){}),Oskari.registerLocalization({lang:"es",key:"userinterface.UserGuide",value:{title:"Ayuda",desc:"",flyout:{title:"Guía de usuario de Paikkatietoikkuna"},tile:{title:"Guía de usuario del mapa"},error:{title:"¡Error!",generic:"Fallo al cargar la guía de usuario. Por favor, inténtelo más tarde."},help:{tags:"map window,user guide",contentPart:"body"}}}),define("bundles/framework/bundle/userguide/locale/es",function(){}),define("src/framework/userguide/module",["oskari","jquery","bundles/framework/bundle/userguide/instance","bundles/framework/bundle/userguide/request/ShowUserGuideRequest","bundles/framework/bundle/userguide/request/ShowUserGuideRequestHandler","bundles/framework/bundle/userguide/service/UserGuideService","bundles/framework/bundle/userguide/Tile","bundles/framework/bundle/userguide/Flyout","css!resources/framework/bundle/userguide/css/style.css","bundles/framework/bundle/userguide/locale/fi","bundles/framework/bundle/userguide/locale/sv","bundles/framework/bundle/userguide/locale/en","bundles/framework/bundle/userguide/locale/cs","bundles/framework/bundle/userguide/locale/de","bundles/framework/bundle/userguide/locale/es"],function(e,t){return e.bundleCls("userguide").category({create:function(){return e.clazz.create("Oskari.mapframework.bundle.userguide.UserGuideBundleInstance")},update:function(e,t,n,r){}})}),requirejs.s.contexts._.nextTick=function(e){e()},require(["css"],function(e){e.setBuffer(".oskari-userguide {\n  width: 480px;\n  min-width: 320px;\n  min-height: 320px; }\n")}),requirejs.s.contexts._.nextTick=requirejs.nextTick;